## **一、模块定位**

  

用户系统是 OpenPenPal 所有功能的基础设施模块，提供注册、登录、身份识别、信息编辑、隐私控制、学校与编码绑定等功能。它支持对信件、信封、AI交互、编码等模块的统一身份追踪，并通过精细字段设计支持人文社交特性与安全审查。

---

## **二、核心功能清单**

|**模块**|**功能描述**|
|---|---|
|用户注册与认证|提供手机号 + 验证码登录（或邮箱预留）、支持后续绑定学校、设置昵称、性别等|
|用户信息与画像系统|用户可完善头像、签名、性别、喜好风格、地址编码、是否公开接受信等|
|隐私设置与控制|是否展示编码、是否接收漂流信、是否公开个人页面|
|学校绑定与认证|注册时选择学校 → 基于前4位 OP Code 填写；可接入高校验证接口（如学号绑定）|
|用户画像标签系统（轻量）|系统根据行为生成“喜欢夜写信”“情绪细腻”“总是公开回信”等标签（供 AI 匹配参考）|
|安全控制|限制频繁发信、限制匿名信频率、用户黑名单、封禁等能力|
|用户中心主页|浏览历史信件、回信列表、AI笔友通信页、收藏的信件/信封、个人页面编辑|

---

## **三、字段设计（User Schema）**

```
User {
  id: string
  nickname: string               // 昵称（可重复）
  phone?: string                 // 手机号（隐私字段）
  email?: string                 // 备用联系邮箱
  avatar_url?: string           // 头像
  gender?: "男" | "女" | "未设置"
  school_code: string           // 前2位编码
  zone_code?: string            // 3–4位片区
  address_code?: string         // 完整 OP Code（可选填写）
  is_receiver: boolean          // 是否接收来信（默认为true）
  is_code_public: boolean       // 编码是否公开
  allow_ai_penpal: boolean      // 是否允许 AI 模拟笔友通信
  user_tags: string[]           // 系统自动识别标签
  bio?: string                  // 个性签名
  created_at: datetime
  updated_at: datetime
  role: "user" | "messenger1" | "messenger2" | "admin"
  status: "active" | "banned"
}
```

---

## **四、主要接口设计（REST 版本）**

  

### **4.1 用户注册**

  

**POST** /api/user/register

```
{
  "phone": "13800001111",
  "code": "478293"
}
```

**返回**：

```
{ "token": "...", "user_id": "user_123" }
```

---

### **4.2 设置学校与编码**

  

**POST** /api/user/bind-school

```
{
  "school_code": "PK",
  "zone_code": "5F"
}
```

---

### **4.3 编辑个人信息**

  

**PUT** /api/user/profile

```
{
  "nickname": "深夜写手",
  "bio": "写给不知道你是谁的人",
  "gender": "女",
  "is_code_public": false,
  "allow_ai_penpal": true
}
```

---

### **4.4 查询某用户是否接受来信**

  

**GET** /api/user/accepts-letter?code=PK5F3D

  

返回：

```
{
  "is_receiver": true,
  "is_code_public": false,
  "nickname": "深夜写手"
}
```

---

## **五、交互设计说明**

- **用户首次注册**时，仅需手机号或邮箱验证码 → 系统引导完善资料（头像、昵称、学校）
    
- **未完善学校信息**的用户将被限制信封购买、条码使用等功能
    
- 可设置“不接受任何来信”，此时写信人输入其编码将提示“用户不接受来信”
    
- 个人主页展示公开信件收藏、标签、AI信件节选（需用户允许展示）
    

---

## **六、安全与审查机制**

|**项目**|**控制逻辑**|
|---|---|
|匿名信频率限制|每周最多发送 3 封匿名信，超过则提示需实名写信|
|黑名单功能|后台或信使可对违规用户封禁，封禁后无法发信|
|多设备登录保护|同一账号多次登录自动提示是否退出其他设备|
|敏感信息屏蔽与模糊处理|昵称/签名/头像/公开信内容均会经过关键词拦截（配合审核系统）|

---

## **七、与其他模块的接口关系**

|**模块**|**交互说明**|
|---|---|
|编码系统|用户填写地址时必须符合合法编码结构，地址注册申请可进入信使审批流|
|信封系统|用户购买信封时自动绑定其 user_id，防重复领取|
|AI系统|AI 模拟笔友与匹配算法依赖用户画像与标签信息|
|写信系统|写信人 ID 与收信人 ID 必须存在并状态为 active|
|信使系统|若为信使，用户信息中需携带对应权限与负责区域|

---

📌 接下来我可以继续输出 **权限系统 FSD**（尤其是信使等级的权限控制逻辑 + OP Code 范围限制），是否继续？✅