## **一、模块定位**

  

条码系统是 OpenPenPal 实体信件投递与信息追踪的唯一标识机制。每个条码代表一封信的身份，从生成、绑定、投递到签收，全流程记录在案，并具有唯一性、可审计性、防篡改性。

  

条码既可独立存在，也可附着于信封。其状态控制了信件是否有效、是否被平台认可、是否可进入物流系统，是所有子模块的通行证。

---

## **二、条码生命周期**

|**阶段**|**状态**|**描述**|
|---|---|---|
|生成|unbound|条码由平台生成或随信封附带生成，尚未绑定内容|
|首次扫码绑定|bound|用户填写收件人+编码后提交，平台锁定信息|
|投递中|in_transit|信使完成扫码 → 更新投递状态为在途中|
|已送达|delivered|收件人扫码查看，或信使确认派送后状态更新|
|漂流转发中|redirecting|漂流信由中转站继续转发中，系统记录新绑定路径|
|无效/过期|expired/invalid|条码已超期或被判定为无效（如伪造）|

---

## **三、功能说明**

  

### **3.1 条码结构设计**

|**字段**|**示例**|**描述**|
|---|---|---|
|条码编号|OPP-BJFU-5F3D-01|唯一编号，含学校码+片区码+点位+流水|
|加密签名|SHA256 哈希值|防伪，系统验证来源与合法性|
|绑定状态|bound/unbound|是否完成信息绑定|
|使用次数限制|1次|条码一经绑定锁定，不能复用|
|下载路径|PDF/PNG二维码贴纸|用户打印贴纸粘贴在信封上|

### **3.2 条码生成方式**

|**获取方式**|**场景说明**|
|---|---|
|写信时自动生成|写信后自动为信件生成编号与二维码|
|信封商城购买|平台印刷好条码并贴于信封寄出|
|自助打印|用户在“条码生成”页填写信件信息 → 下载PDF打印贴纸|
|线下领取|可在合作门店/信使处领取实体贴纸（系统记录发放编号）|
|单独购买（商城）|不附信封，仅购买条码贴纸功能与信封版一致|

---

## **四、绑定机制**

  

### **首次绑定规则**

- 条码首次扫码时跳转到“绑定页”，需填写：
    
    - 收件人昵称或实名（可设置是否公开）
        
    - 收件人 OP Code（6位）
        
    - 是否为漂流信
        
    
- 一经提交即锁定绑定，平台记录不可更改
    

  

### **验证机制**

- 所有条码必须验证来源为平台生成（具备签名）
    
- 重复扫码：提示“已绑定，编号：XXX，当前状态：YYY”
    
- 非平台条码：提示“条码编号非法或未备案”
    

---

## **五、后台管理与追踪字段（核心数据模型）**

```
Barcode {
  barcode_id: string,      // OPP-BJFU-5F3D-01
  created_by: user_id | system,
  bind_status: "unbound" | "bound" | "in_transit" | "delivered" | "expired",
  bound_by_user: user_id,
  bind_time: timestamp,
  delivery_code: string,   // 收件人OP编码
  delivery_type: "定向" | "漂流-AI" | "漂流-中转站",
  is_anonymous: boolean,
  scanned_by: courier_id[],
  final_delivery_time: timestamp,
  associated_letter_id: string
}
```

---

## **六、平台功能支持**

- 📦 快速查件：扫码后展示当前信件状态、投递路径
    
- 🔄 状态同步：信使扫码可更新状态；收件人扫码确认收件
    
- 🛡️ 防伪追踪：平台可比对生成来源、防止伪造编号
    
- 🧾 统一日志：所有条码绑定、修改、读取行为均有审计日志记录
    

---

## **七、与其他模块接口说明**

|**模块**|**接口内容说明**|
|---|---|
|写信系统|每次写信后生成条码，返回贴纸 PDF 供用户下载|
|信封系统|信封发放时自动附带条码，后台记录条码归属与编号段|
|编码系统|条码绑定时须校验 OP Code 是否存在、是否已开放|
|信使系统|扫码更新状态，平台判定是否进入“在途/送达”流程|
|AI系统|匿名漂流信需将收件人编码通过系统匹配写入条码绑定项|

---

## **八、安全与性能要求**

|**类别**|**要求说明**|
|---|---|
|唯一性|所有条码编号系统校验唯一，不可重复|
|安全性|条码编号采用加密签名，伪造扫码提示无效|
|稳定性|条码绑定与状态查询接口 99.9% 可用性|
|审计能力|平台可追踪任意条码的历史状态变化轨迹|
|用户体验|条码扫码跳转页面响应时间 < 0.5 秒|

---

是否继续输出下一个模块：📦 信使系统？如需我补充二维码生成逻辑、样式规范或条码使用示意图，也可以同步生成 ✅