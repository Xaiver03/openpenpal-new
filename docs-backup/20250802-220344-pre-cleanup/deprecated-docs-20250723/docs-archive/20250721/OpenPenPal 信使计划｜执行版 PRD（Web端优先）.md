# 📘 

---

## 🧭 一、项目概述

- **产品名称**：OpenPenPal（信使计划）
    
- **产品形态**：响应式 Web App（后续可迁移至小程序）
    
- **核心目标**：实现“用户写手写信 + 平台生成编号 + 信使扫码转送 + 收信人扫码查看 + 可回信”的完整闭环体验
    

---

## 🧱 二、功能结构（MVP）

### 用户端功能模块（Web）

|页面路径|页面名称|功能目标|
|---|---|---|
|`/write`|写信页|用户编辑文字草稿，生成唯一编号与二维码贴纸，用于手写后贴至实体信封|
|`/deliver`|投递页|展示生成的编号与二维码，提供投递点指引与操作引导，支持上传信件照片|
|`/read/:code`|收信页|用户收到信后扫码查看状态，可回信|
|`/mailbox`|我的信箱|显示历史写信、收信、未来信等记录（含信件照片）|

### 信使端功能模块

|页面路径|页面名称|功能目标|
|---|---|---|
|`/courier/tasks`|今日任务|展示待处理编号、已完成记录|
|`/courier/scan`|扫码登记|手动输入编号或扫码录入，变更信件状态|
|`/courier/history`|投递记录|查看过往投递数据与任务统计|

### 管理后台（初版）

- 编号查看与绑定记录
    
- 信件状态流转日志
    
- 用户/信使简易查询
    
- 上传内容审核队列（可选）
    

---

## 📦 三、功能说明

### 📝 写信页 `/write`

|功能项|描述|
|---|---|
|富文本编辑器|用户输入草稿内容（仅供手抄，不上传）|
|样式选择|可选 3–5 套信纸背景样式（仅预览）|
|编号生成|调用API生成唯一编号+二维码图|
|下载贴纸|生成二维码图片 + 编号文本合成贴纸图|
|写信指引|提示用户：手抄内容、贴编号、投递方式说明|

### 📷 上传信件照片（写信人）

|项目|内容|
|---|---|
|入口位置|`/write` 写信完成页 或 `/deliver` 页面中|
|上传文件|JPG / PNG，≤ 5MB，压缩存储|
|与编号绑定|一对一绑定 `code_id`，存档记录|
|默认状态|私密，仅用户本人可见|
|可选公开|用户勾选后平台审核，展示于公开信墙|
|可管理|用户可在“我的信箱”中查看/删除/修改公开状态|

### 📬 投递页 `/deliver`

|功能项|描述|
|---|---|
|展示贴纸|展示编号与二维码（可下载）|
|投递点推荐|基于学校推荐投递点|
|状态说明|展示当前信件状态（待扫码/已收/在途/送达）|
|上传照片提示|引导上传手写信照片（见上）|

### 📖 收信页 `/read/:code`

|功能项|描述|
|---|---|
|状态识别|解析编号，展示信件当前状态|
|回信按钮|跳转 `/write?reply_to=xxx`，带入原编号|
|信件照片查看|若收件人也上传了信件照片，可在此页查看|

### 🎒 信使页 `/courier/scan`

|功能项|描述|
|---|---|
|输入编号|手动输入/扫码录入编号|
|状态变更|修改状态为“在途”或“已送达”|
|日志记录|生成任务记录（含信使ID、时间戳）|

---

## 🧩 四、数据结构（核心）

### Code 编号表

```ts
{
  code_id: string;
  user_id: string;
  status: 'draft' | 'collected' | 'in_transit' | 'delivered';
  created_at: datetime;
  delivered_at?: datetime;
  reply_to?: string;
}
```

### User 用户表

```ts
{
  user_id: string;
  role: 'user' | 'courier' | 'admin';
  school_code: string;
  nickname: string;
}
```

### LetterPhoto 信件照片表

```ts
{
  photo_id: string;
  code_id: string;
  user_id: string;
  image_url: string;
  is_public: boolean;
  created_at: datetime;
}
```

### CourierLog 信使任务表

```ts
{
  log_id: string;
  courier_id: string;
  code_id: string;
  status: 'collected' | 'in_transit' | 'delivered';
  timestamp: datetime;
}
```

---

## 🔐 五、权限控制与登录方式

|用户类型|登录方式|权限说明|
|---|---|---|
|普通用户|微信OAuth或手机号登录|写信、回信、上传照片、查状态|
|信使用户|管理员授权|扫码任务、任务管理页面权限|
|管理员|系统账号|后台全权限|

---

## 🔁 六、迭代计划

### ✅ MVP（第1阶段）

- 写信页草稿 + 生成编号贴纸
    
- 投递页状态展示
    
- 信使扫码任务登记
    
- 收信页展示与回信
    
- 用户上传照片（默认私密）
    
- 后台查看编号/状态日志
    

### ⏭ V1.1（第2阶段）

- 写作广场 / 公开信墙
    
- 用户等级与积分
    
- 上传照片审核机制
    

### ⏭ V1.2（第3阶段）

- 城市漂流地图 / 未来信 / 商城兑换
    
