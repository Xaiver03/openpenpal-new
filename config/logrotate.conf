# OpenPenPal日志轮转配置 - 优化版本

# 全局配置
compress
delaycompress
missingok
notifempty
create 644 root root
dateext
dateformat -%Y%m%d-%s

# 🔴 CRITICAL: Backend应用日志 - 防止日志爆炸
/Users/rocalight/同步空间/opplc/openpenpal/backend/*.log {
    hourly
    rotate 24
    size 50M
    maxsize 100M
    compress
    delaycompress
    copytruncate
    sharedscripts
    postrotate
        # 发送日志轮转通知
        echo "$(date): Backend logs rotated" >> /Users/rocalight/同步空间/opplc/openpenpal/logs/logrotate.log
    endscript
}

# Backend子目录日志
/Users/rocalight/同步空间/opplc/openpenpal/backend/**/*.log {
    hourly
    rotate 12
    size 25M
    maxsize 50M
    compress
    delaycompress
    copytruncate
}

# 应用日志
/Users/rocalight/同步空间/opplc/openpenpal/logs/app/*.log {
    daily
    rotate 30
    size 100M
    postrotate
        # 重启应用以重新打开日志文件 (如果需要)
        # systemctl reload openpenpal || true
    endscript
}

# Frontend日志
/Users/rocalight/同步空间/opplc/openpenpal/frontend/*.log {
    daily
    rotate 14
    size 100M
    compress
    delaycompress
    copytruncate
}

# 访问日志
/Users/rocalight/同步空间/opplc/openpenpal/logs/access/*.log {
    daily
    rotate 90
    size 500M
    compress
    delaycompress
}

# 错误日志
/Users/rocalight/同步空间/opplc/openpenpal/logs/error/*.log {
    daily
    rotate 60
    size 50M
    compress
    delaycompress
    copytruncate
}

# 性能日志
/Users/rocalight/同步空间/opplc/openpenpal/logs/performance/*.log {
    weekly
    rotate 12
    size 200M
    compress
    delaycompress
}

# 调试和临时日志 - 更激进的清理
/Users/rocalight/同步空间/opplc/openpenpal/**/*debug*.log {
    hourly
    rotate 6
    size 10M
    maxsize 20M
    compress
    copytruncate
}

/Users/rocalight/同步空间/opplc/openpenpal/**/*temp*.log {
    hourly
    rotate 3
    size 5M
    maxsize 10M
    compress
    copytruncate
}
