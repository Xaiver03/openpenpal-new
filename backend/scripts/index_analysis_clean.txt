 schemaname |      tablename      |                 indexname                 |                                                                                                          indexdef                                                                                                           | tablespace 
------------+---------------------+-------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------
 public     | ai_matches          | ai_matches_pkey                           | CREATE UNIQUE INDEX ai_matches_pkey ON public.ai_matches USING btree (id)                                                                                                                                                   | 
 public     | ai_matches          | idx_ai_matches_letter_id                  | CREATE INDEX idx_ai_matches_letter_id ON public.ai_matches USING btree (letter_id)                                                                                                                                          | 
 public     | ai_matches          | idx_ai_matches_matched_user_id            | CREATE INDEX idx_ai_matches_matched_user_id ON public.ai_matches USING btree (matched_user_id)                                                                                                                              | 
 public     | ai_replies          | ai_replies_pkey                           | CREATE UNIQUE INDEX ai_replies_pkey ON public.ai_replies USING btree (id)                                                                                                                                                   | 
 public     | ai_replies          | idx_ai_replies_original_letter_id         | CREATE INDEX idx_ai_replies_original_letter_id ON public.ai_replies USING btree (original_letter_id)                                                                                                                        | 
 public     | ai_replies          | idx_ai_replies_reply_letter_id            | CREATE INDEX idx_ai_replies_reply_letter_id ON public.ai_replies USING btree (reply_letter_id)                                                                                                                              | 
 public     | comments            | comments_pkey                             | CREATE UNIQUE INDEX comments_pkey ON public.comments USING btree (id)                                                                                                                                                       | 
 public     | comments            | idx_comments_deleted_at                   | CREATE INDEX idx_comments_deleted_at ON public.comments USING btree (deleted_at)                                                                                                                                            | 
 public     | comments            | idx_comments_letter_id                    | CREATE INDEX idx_comments_letter_id ON public.comments USING btree (letter_id)                                                                                                                                              | 
 public     | comments            | idx_comments_parent_id                    | CREATE INDEX idx_comments_parent_id ON public.comments USING btree (parent_id)                                                                                                                                              | 
 public     | comments            | idx_comments_user_id                      | CREATE INDEX idx_comments_user_id ON public.comments USING btree (user_id)                                                                                                                                                  | 
 public     | courier_tasks       | courier_tasks_pkey                        | CREATE UNIQUE INDEX courier_tasks_pkey ON public.courier_tasks USING btree (id)                                                                                                                                             | 
 public     | courier_tasks       | idx_courier_tasks_courier_id              | CREATE INDEX idx_courier_tasks_courier_id ON public.courier_tasks USING btree (courier_id)                                                                                                                                  | 
 public     | courier_tasks       | idx_courier_tasks_courier_status_priority | CREATE INDEX idx_courier_tasks_courier_status_priority ON public.courier_tasks USING btree (courier_id, status, priority, created_at DESC)                                                                                  | 
 public     | courier_tasks       | idx_courier_tasks_current_op_code         | CREATE INDEX idx_courier_tasks_current_op_code ON public.courier_tasks USING btree (current_op_code)                                                                                                                        | 
 public     | courier_tasks       | idx_courier_tasks_current_opcode_status   | CREATE INDEX idx_courier_tasks_current_opcode_status ON public.courier_tasks USING btree (current_op_code, status) WHERE ((current_op_code)::text <> ''::text)                                                              | 
 public     | courier_tasks       | idx_courier_tasks_deadline_status         | CREATE INDEX idx_courier_tasks_deadline_status ON public.courier_tasks USING btree (deadline, status) WHERE (deadline IS NOT NULL)                                                                                          | 
 public     | courier_tasks       | idx_courier_tasks_delivery_op             | CREATE INDEX idx_courier_tasks_delivery_op ON public.courier_tasks USING btree (delivery_op_code)                                                                                                                           | 
 public     | courier_tasks       | idx_courier_tasks_delivery_op_code        | CREATE INDEX idx_courier_tasks_delivery_op_code ON public.courier_tasks USING btree (delivery_op_code)                                                                                                                      | 
 public     | courier_tasks       | idx_courier_tasks_geo_routing             | CREATE INDEX idx_courier_tasks_geo_routing ON public.courier_tasks USING btree (pickup_op_code, delivery_op_code, status, priority) WHERE (((pickup_op_code)::text <> ''::text) AND ((delivery_op_code)::text <> ''::text)) | 
 public     | courier_tasks       | idx_courier_tasks_letter_code             | CREATE INDEX idx_courier_tasks_letter_code ON public.courier_tasks USING btree (letter_code)                                                                                                                                | 
 public     | courier_tasks       | idx_courier_tasks_pickup_delivery_opcode  | CREATE INDEX idx_courier_tasks_pickup_delivery_opcode ON public.courier_tasks USING btree (pickup_op_code, delivery_op_code) WHERE (((pickup_op_code)::text <> ''::text) AND ((delivery_op_code)::text <> ''::text))        | 
 public     | courier_tasks       | idx_courier_tasks_pickup_op               | CREATE INDEX idx_courier_tasks_pickup_op ON public.courier_tasks USING btree (pickup_op_code)                                                                                                                               | 
 public     | courier_tasks       | idx_courier_tasks_pickup_op_code          | CREATE INDEX idx_courier_tasks_pickup_op_code ON public.courier_tasks USING btree (pickup_op_code)                                                                                                                          | 
 public     | couriers            | couriers_pkey                             | CREATE UNIQUE INDEX couriers_pkey ON public.couriers USING btree (id)                                                                                                                                                       | 
 public     | couriers            | idx_couriers_active_hierarchy             | CREATE INDEX idx_couriers_active_hierarchy ON public.couriers USING btree (parent_id, level, created_at DESC) WHERE (((status)::text = 'approved'::text) AND (deleted_at IS NULL))                                          | 
 public     | couriers            | idx_couriers_created_by_id                | CREATE INDEX idx_couriers_created_by_id ON public.couriers USING btree (created_by_id)                                                                                                                                      | 
 public     | couriers            | idx_couriers_created_by_time              | CREATE INDEX idx_couriers_created_by_time ON public.couriers USING btree (created_by_id, created_at DESC) WHERE (created_by_id IS NOT NULL)                                                                                 | 
 public     | couriers            | idx_couriers_deleted_at                   | CREATE INDEX idx_couriers_deleted_at ON public.couriers USING btree (deleted_at)                                                                                                                                            | 
 public     | couriers            | idx_couriers_level_zone_active            | CREATE INDEX idx_couriers_level_zone_active ON public.couriers USING btree (level, zone_code, deleted_at) WHERE (deleted_at IS NULL)                                                                                        | 
 public     | couriers            | idx_couriers_managed_op_code_prefix       | CREATE INDEX idx_couriers_managed_op_code_prefix ON public.couriers USING btree (managed_op_code_prefix)                                                                                                                    | 
 public     | couriers            | idx_couriers_managed_prefix               | CREATE INDEX idx_couriers_managed_prefix ON public.couriers USING btree (managed_op_code_prefix)                                                                                                                            | 
 public     | couriers            | idx_couriers_managed_prefix_level         | CREATE INDEX idx_couriers_managed_prefix_level ON public.couriers USING btree (managed_op_code_prefix, level) WHERE ((managed_op_code_prefix)::text <> ''::text)                                                            | 
 public     | couriers            | idx_couriers_parent_id                    | CREATE INDEX idx_couriers_parent_id ON public.couriers USING btree (parent_id)                                                                                                                                              | 
 public     | couriers            | idx_couriers_parent_level                 | CREATE INDEX idx_couriers_parent_level ON public.couriers USING btree (parent_id, level) WHERE (parent_id IS NOT NULL)                                                                                                      | 
 public     | couriers            | idx_couriers_status_level                 | CREATE INDEX idx_couriers_status_level ON public.couriers USING btree (status, level, deleted_at) WHERE (deleted_at IS NULL)                                                                                                | 
 public     | couriers            | idx_couriers_user_id                      | CREATE INDEX idx_couriers_user_id ON public.couriers USING btree (user_id)                                                                                                                                                  | 
 public     | couriers            | idx_couriers_zone_code                    | CREATE INDEX idx_couriers_zone_code ON public.couriers USING btree (zone_code)                                                                                                                                              | 
 public     | credit_transactions | credit_transactions_pkey                  | CREATE UNIQUE INDEX credit_transactions_pkey ON public.credit_transactions USING btree (id)                                                                                                                                 | 
 public     | credit_transactions | idx_credit_transactions_expired_at        | CREATE INDEX idx_credit_transactions_expired_at ON public.credit_transactions USING btree (expired_at) WHERE (expired_at IS NOT NULL)                                                                                       | 
 public     | credit_transactions | idx_credit_transactions_expires_at        | CREATE INDEX idx_credit_transactions_expires_at ON public.credit_transactions USING btree (expires_at)                                                                                                                      | 
 public     | credit_transactions | idx_credit_transactions_is_expired        | CREATE INDEX idx_credit_transactions_is_expired ON public.credit_transactions USING btree (is_expired)                                                                                                                      | 
 public     | credit_transactions | idx_credit_transactions_user_id           | CREATE INDEX idx_credit_transactions_user_id ON public.credit_transactions USING btree (user_id)                                                                                                                            | 
 public     | envelopes           | envelopes_pkey                            | CREATE UNIQUE INDEX envelopes_pkey ON public.envelopes USING btree (id)                                                                                                                                                     | 
 public     | envelopes           | idx_envelopes_letter_id                   | CREATE INDEX idx_envelopes_letter_id ON public.envelopes USING btree (letter_id)                                                                                                                                            | 
 public     | envelopes           | idx_envelopes_recipient_op_code           | CREATE INDEX idx_envelopes_recipient_op_code ON public.envelopes USING btree (recipient_op_code)                                                                                                                            | 
 public     | envelopes           | idx_envelopes_sender_op_code              | CREATE INDEX idx_envelopes_sender_op_code ON public.envelopes USING btree (sender_op_code)                                                                                                                                  | 
 public     | envelopes           | uni_envelopes_barcode_id                  | CREATE UNIQUE INDEX uni_envelopes_barcode_id ON public.envelopes USING btree (barcode_id)                                                                                                                                   | 
 public     | letter_codes        | idx_letter_codes_bound_delivered          | CREATE INDEX idx_letter_codes_bound_delivered ON public.letter_codes USING btree (bound_at, delivered_at) WHERE (bound_at IS NOT NULL)                                                                                      | 
 public     | letter_codes        | idx_letter_codes_code                     | CREATE UNIQUE INDEX idx_letter_codes_code ON public.letter_codes USING btree (code)                                                                                                                                         | 
 public     | letter_codes        | idx_letter_codes_envelope_id              | CREATE INDEX idx_letter_codes_envelope_id ON public.letter_codes USING btree (envelope_id)                                                                                                                                  | 
 public     | letter_codes        | idx_letter_codes_envelope_status          | CREATE INDEX idx_letter_codes_envelope_status ON public.letter_codes USING btree (envelope_id, status) WHERE ((envelope_id)::text <> ''::text)                                                                              | 
 public     | letter_codes        | idx_letter_codes_letter_id                | CREATE UNIQUE INDEX idx_letter_codes_letter_id ON public.letter_codes USING btree (letter_id)                                                                                                                               | 
 public     | letter_codes        | idx_letter_codes_recipient_code           | CREATE INDEX idx_letter_codes_recipient_code ON public.letter_codes USING btree (recipient_code)                                                                                                                            | 
 public     | letter_codes        | idx_letter_codes_recipient_code_status    | CREATE INDEX idx_letter_codes_recipient_code_status ON public.letter_codes USING btree (recipient_code, status) WHERE ((recipient_code)::text <> ''::text)                                                                  | 
 public     | letter_codes        | idx_letter_codes_scanned_by_time          | CREATE INDEX idx_letter_codes_scanned_by_time ON public.letter_codes USING btree (last_scanned_by, last_scanned_at DESC) WHERE ((last_scanned_by)::text <> ''::text)                                                        | 
 public     | letter_codes        | idx_letter_codes_status                   | CREATE INDEX idx_letter_codes_status ON public.letter_codes USING btree (status)                                                                                                                                            | 
 public     | letter_codes        | idx_letter_codes_status_updated           | CREATE INDEX idx_letter_codes_status_updated ON public.letter_codes USING btree (status, updated_at DESC)                                                                                                                   | 
 public     | letter_codes        | letter_codes_pkey                         | CREATE UNIQUE INDEX letter_codes_pkey ON public.letter_codes USING btree (id)                                                                                                                                               | 
 public     | letter_likes        | idx_letter_likes_letter_created           | CREATE INDEX idx_letter_likes_letter_created ON public.letter_likes USING btree (letter_id, created_at DESC)                                                                                                                | 
 public     | letter_likes        | idx_letter_likes_letter_id                | CREATE INDEX idx_letter_likes_letter_id ON public.letter_likes USING btree (letter_id)                                                                                                                                      | 
 public     | letter_likes        | idx_letter_likes_user_created             | CREATE INDEX idx_letter_likes_user_created ON public.letter_likes USING btree (user_id, created_at DESC)                                                                                                                    | 
 public     | letter_likes        | idx_letter_likes_user_id                  | CREATE INDEX idx_letter_likes_user_id ON public.letter_likes USING btree (user_id)                                                                                                                                          | 
 public     | letter_likes        | letter_likes_pkey                         | CREATE UNIQUE INDEX letter_likes_pkey ON public.letter_likes USING btree (id)                                                                                                                                               | 
 public     | letter_photos       | idx_letter_photos_letter_id               | CREATE INDEX idx_letter_photos_letter_id ON public.letter_photos USING btree (letter_id)                                                                                                                                    | 
 public     | letter_photos       | letter_photos_pkey                        | CREATE UNIQUE INDEX letter_photos_pkey ON public.letter_photos USING btree (id)                                                                                                                                             | 
 public     | letter_shares       | idx_letter_shares_letter_id               | CREATE INDEX idx_letter_shares_letter_id ON public.letter_shares USING btree (letter_id)                                                                                                                                    | 
 public     | letter_shares       | idx_letter_shares_platform_created        | CREATE INDEX idx_letter_shares_platform_created ON public.letter_shares USING btree (platform, created_at DESC)                                                                                                             | 
 public     | letter_shares       | idx_letter_shares_user_id                 | CREATE INDEX idx_letter_shares_user_id ON public.letter_shares USING btree (user_id)                                                                                                                                        | 
 public     | letter_shares       | letter_shares_pkey                        | CREATE UNIQUE INDEX letter_shares_pkey ON public.letter_shares USING btree (id)                                                                                                                                             | 
 public     | letters             | idx_letters_active_drafts                 | CREATE INDEX idx_letters_active_drafts ON public.letters USING btree (user_id, updated_at DESC) WHERE (((status)::text = 'draft'::text) AND (deleted_at IS NULL))                                                           | 
 public     | letters             | idx_letters_author_id                     | CREATE INDEX idx_letters_author_id ON public.letters USING btree (author_id)                                                                                                                                                | 
 public     | letters             | idx_letters_complex_search                | CREATE INDEX idx_letters_complex_search ON public.letters USING btree (user_id, status, visibility, created_at DESC) WHERE (deleted_at IS NULL)                                                                             | 
 public     | letters             | idx_letters_courier_id                    | CREATE INDEX idx_letters_courier_id ON public.letters USING btree (courier_id)                                                                                                                                              | 
 public     | letters             | idx_letters_deleted_at                    | CREATE INDEX idx_letters_deleted_at ON public.letters USING btree (deleted_at)                                                                                                                                              | 
 public     | letters             | idx_letters_envelope_id                   | CREATE INDEX idx_letters_envelope_id ON public.letters USING btree (envelope_id)                                                                                                                                            | 
 public     | letters             | idx_letters_in_transit                    | CREATE INDEX idx_letters_in_transit ON public.letters USING btree (recipient_op_code, updated_at DESC) WHERE ((status)::text = ANY ((ARRAY['collected'::character varying, 'in_transit'::character varying])::text[]))      | 
 public     | letters             | idx_letters_recipient_id                  | CREATE INDEX idx_letters_recipient_id ON public.letters USING btree (recipient_id)                                                                                                                                          | 
 public     | letters             | idx_letters_recipient_op_code             | CREATE INDEX idx_letters_recipient_op_code ON public.letters USING btree (recipient_op_code)                                                                                                                                | 
 public     | letters             | idx_letters_recipient_opcode_status       | CREATE INDEX idx_letters_recipient_opcode_status ON public.letters USING btree (recipient_op_code, status) WHERE ((recipient_op_code)::text <> ''::text)                                                                    | 
 public     | letters             | idx_letters_reply_to                      | CREATE INDEX idx_letters_reply_to ON public.letters USING btree (reply_to)                                                                                                                                                  | 
 public     | letters             | idx_letters_reply_to_created              | CREATE INDEX idx_letters_reply_to_created ON public.letters USING btree (reply_to, created_at DESC) WHERE ((reply_to)::text <> ''::text)                                                                                    | 
 public     | letters             | idx_letters_scheduled_at                  | CREATE INDEX idx_letters_scheduled_at ON public.letters USING btree (scheduled_at)                                                                                                                                          | 
 public     | letters             | idx_letters_sender_op_code                | CREATE INDEX idx_letters_sender_op_code ON public.letters USING btree (sender_op_code)                                                                                                                                      | 
 public     | letters             | idx_letters_sender_opcode_created         | CREATE INDEX idx_letters_sender_opcode_created ON public.letters USING btree (sender_op_code, created_at DESC) WHERE ((sender_op_code)::text <> ''::text)                                                                   | 
 public     | letters             | idx_letters_type_visibility_created       | CREATE INDEX idx_letters_type_visibility_created ON public.letters USING btree (type, visibility, created_at DESC)                                                                                                          | 
 public     | letters             | idx_letters_user_id                       | CREATE INDEX idx_letters_user_id ON public.letters USING btree (user_id)                                                                                                                                                    | 
 public     | letters             | idx_letters_user_status_created           | CREATE INDEX idx_letters_user_status_created ON public.letters USING btree (user_id, status, created_at DESC)                                                                                                               | 
 public     | letters             | letters_pkey                              | CREATE UNIQUE INDEX letters_pkey ON public.letters USING btree (id)                                                                                                                                                         | 
 public     | moderation_records  | idx_moderation_records_content_id         | CREATE INDEX idx_moderation_records_content_id ON public.moderation_records USING btree (content_id)                                                                                                                        | 
 public     | moderation_records  | idx_moderation_records_content_type       | CREATE INDEX idx_moderation_records_content_type ON public.moderation_records USING btree (content_type)                                                                                                                    | 
 public     | moderation_records  | idx_moderation_records_user_id            | CREATE INDEX idx_moderation_records_user_id ON public.moderation_records USING btree (user_id)                                                                                                                              | 
 public     | moderation_records  | moderation_records_pkey                   | CREATE UNIQUE INDEX moderation_records_pkey ON public.moderation_records USING btree (id)                                                                                                                                   | 
 public     | museum_collections  | museum_collections_pkey                   | CREATE UNIQUE INDEX museum_collections_pkey ON public.museum_collections USING btree (id)                                                                                                                                   | 
 public     | museum_items        | idx_museum_items_origin_op_code           | CREATE INDEX idx_museum_items_origin_op_code ON public.museum_items USING btree (origin_op_code)                                                                                                                            | 
 public     | museum_items        | museum_items_pkey                         | CREATE UNIQUE INDEX museum_items_pkey ON public.museum_items USING btree (id)                                                                                                                                               | 
 public     | notifications       | idx_notifications_user_id                 | CREATE INDEX idx_notifications_user_id ON public.notifications USING btree (user_id)                                                                                                                                        | 
 public     | notifications       | notifications_pkey                        | CREATE UNIQUE INDEX notifications_pkey ON public.notifications USING btree (id)                                                                                                                                             | 
 public     | status_logs         | idx_status_logs_letter_id                 | CREATE INDEX idx_status_logs_letter_id ON public.status_logs USING btree (letter_id)                                                                                                                                        | 
 public     | status_logs         | idx_status_logs_letter_status_created     | CREATE INDEX idx_status_logs_letter_status_created ON public.status_logs USING btree (letter_id, status, created_at DESC)                                                                                                   | 
 public     | status_logs         | idx_status_logs_updated_by_created        | CREATE INDEX idx_status_logs_updated_by_created ON public.status_logs USING btree (updated_by, created_at DESC) WHERE ((updated_by)::text <> ''::text)                                                                      | 
 public     | status_logs         | status_logs_pkey                          | CREATE UNIQUE INDEX status_logs_pkey ON public.status_logs USING btree (id)                                                                                                                                                 | 
 public     | user_credits        | idx_user_credits_user_id                  | CREATE UNIQUE INDEX idx_user_credits_user_id ON public.user_credits USING btree (user_id)                                                                                                                                   | 
 public     | user_credits        | user_credits_pkey                         | CREATE UNIQUE INDEX user_credits_pkey ON public.user_credits USING btree (id)                                                                                                                                               | 
 public     | user_profiles       | user_profiles_pkey                        | CREATE UNIQUE INDEX user_profiles_pkey ON public.user_profiles USING btree (user_id)                                                                                                                                        | 
 public     | users               | idx_users_created_role                    | CREATE INDEX idx_users_created_role ON public.users USING btree (created_at DESC, role) WHERE (deleted_at IS NULL)                                                                                                          | 
 public     | users               | idx_users_deleted_at                      | CREATE INDEX idx_users_deleted_at ON public.users USING btree (deleted_at)                                                                                                                                                  | 
 public     | users               | idx_users_email                           | CREATE UNIQUE INDEX idx_users_email ON public.users USING btree (email)                                                                                                                                                     | 
 public     | users               | idx_users_op_code                         | CREATE INDEX idx_users_op_code ON public.users USING btree (op_code)                                                                                                                                                        | 
 public     | users               | idx_users_role_school_active              | CREATE INDEX idx_users_role_school_active ON public.users USING btree (role, school_code, is_active) WHERE (is_active = true)                                                                                               | 
 public     | users               | idx_users_school_code                     | CREATE INDEX idx_users_school_code ON public.users USING btree (school_code)                                                                                                                                                | 
 public     | users               | idx_users_username                        | CREATE UNIQUE INDEX idx_users_username ON public.users USING btree (username)                                                                                                                                               | 
 public     | users               | users_pkey                                | CREATE UNIQUE INDEX users_pkey ON public.users USING btree (id)                                                                                                                                                             | 
(113 rows)

psql:scripts/analyze_indexes_fixed.sql:39: ERROR:  column s.tablename does not exist
LINE 3:     s.tablename,
            ^
  table_name   |                         duplicate_indexes                          |       column_names       
---------------+--------------------------------------------------------------------+--------------------------
 courier_tasks | {idx_courier_tasks_delivery_op_code,idx_courier_tasks_delivery_op} | {delivery_op_code}
 courier_tasks | {idx_courier_tasks_pickup_op_code,idx_courier_tasks_pickup_op}     | {pickup_op_code}
 couriers      | {idx_couriers_managed_prefix,idx_couriers_managed_op_code_prefix}  | {managed_op_code_prefix}
(3 rows)

 schemaname |   tablename   |                 indexname                 |                                                                                                          indexdef                                                                                                           
------------+---------------+-------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 public     | courier_tasks | idx_courier_tasks_courier_status_priority | CREATE INDEX idx_courier_tasks_courier_status_priority ON public.courier_tasks USING btree (courier_id, status, priority, created_at DESC)
 public     | courier_tasks | idx_courier_tasks_current_opcode_status   | CREATE INDEX idx_courier_tasks_current_opcode_status ON public.courier_tasks USING btree (current_op_code, status) WHERE ((current_op_code)::text <> ''::text)
 public     | courier_tasks | idx_courier_tasks_deadline_status         | CREATE INDEX idx_courier_tasks_deadline_status ON public.courier_tasks USING btree (deadline, status) WHERE (deadline IS NOT NULL)
 public     | courier_tasks | idx_courier_tasks_geo_routing             | CREATE INDEX idx_courier_tasks_geo_routing ON public.courier_tasks USING btree (pickup_op_code, delivery_op_code, status, priority) WHERE (((pickup_op_code)::text <> ''::text) AND ((delivery_op_code)::text <> ''::text))
 public     | courier_tasks | idx_courier_tasks_pickup_delivery_opcode  | CREATE INDEX idx_courier_tasks_pickup_delivery_opcode ON public.courier_tasks USING btree (pickup_op_code, delivery_op_code) WHERE (((pickup_op_code)::text <> ''::text) AND ((delivery_op_code)::text <> ''::text))
 public     | couriers      | idx_couriers_active_hierarchy             | CREATE INDEX idx_couriers_active_hierarchy ON public.couriers USING btree (parent_id, level, created_at DESC) WHERE (((status)::text = 'approved'::text) AND (deleted_at IS NULL))
 public     | couriers      | idx_couriers_created_by_time              | CREATE INDEX idx_couriers_created_by_time ON public.couriers USING btree (created_by_id, created_at DESC) WHERE (created_by_id IS NOT NULL)
 public     | couriers      | idx_couriers_level_zone_active            | CREATE INDEX idx_couriers_level_zone_active ON public.couriers USING btree (level, zone_code, deleted_at) WHERE (deleted_at IS NULL)
 public     | couriers      | idx_couriers_managed_prefix_level         | CREATE INDEX idx_couriers_managed_prefix_level ON public.couriers USING btree (managed_op_code_prefix, level) WHERE ((managed_op_code_prefix)::text <> ''::text)
 public     | couriers      | idx_couriers_parent_level                 | CREATE INDEX idx_couriers_parent_level ON public.couriers USING btree (parent_id, level) WHERE (parent_id IS NOT NULL)
 public     | couriers      | idx_couriers_status_level                 | CREATE INDEX idx_couriers_status_level ON public.couriers USING btree (status, level, deleted_at) WHERE (deleted_at IS NULL)
 public     | letter_codes  | idx_letter_codes_bound_delivered          | CREATE INDEX idx_letter_codes_bound_delivered ON public.letter_codes USING btree (bound_at, delivered_at) WHERE (bound_at IS NOT NULL)
 public     | letter_codes  | idx_letter_codes_envelope_status          | CREATE INDEX idx_letter_codes_envelope_status ON public.letter_codes USING btree (envelope_id, status) WHERE ((envelope_id)::text <> ''::text)
 public     | letter_codes  | idx_letter_codes_recipient_code_status    | CREATE INDEX idx_letter_codes_recipient_code_status ON public.letter_codes USING btree (recipient_code, status) WHERE ((recipient_code)::text <> ''::text)
 public     | letter_codes  | idx_letter_codes_scanned_by_time          | CREATE INDEX idx_letter_codes_scanned_by_time ON public.letter_codes USING btree (last_scanned_by, last_scanned_at DESC) WHERE ((last_scanned_by)::text <> ''::text)
 public     | letter_codes  | idx_letter_codes_status_updated           | CREATE INDEX idx_letter_codes_status_updated ON public.letter_codes USING btree (status, updated_at DESC)
 public     | letter_likes  | idx_letter_likes_letter_created           | CREATE INDEX idx_letter_likes_letter_created ON public.letter_likes USING btree (letter_id, created_at DESC)
 public     | letter_likes  | idx_letter_likes_user_created             | CREATE INDEX idx_letter_likes_user_created ON public.letter_likes USING btree (user_id, created_at DESC)
 public     | letter_shares | idx_letter_shares_platform_created        | CREATE INDEX idx_letter_shares_platform_created ON public.letter_shares USING btree (platform, created_at DESC)
 public     | letters       | idx_letters_active_drafts                 | CREATE INDEX idx_letters_active_drafts ON public.letters USING btree (user_id, updated_at DESC) WHERE (((status)::text = 'draft'::text) AND (deleted_at IS NULL))
 public     | letters       | idx_letters_complex_search                | CREATE INDEX idx_letters_complex_search ON public.letters USING btree (user_id, status, visibility, created_at DESC) WHERE (deleted_at IS NULL)
 public     | letters       | idx_letters_in_transit                    | CREATE INDEX idx_letters_in_transit ON public.letters USING btree (recipient_op_code, updated_at DESC) WHERE ((status)::text = ANY ((ARRAY['collected'::character varying, 'in_transit'::character varying])::text[]))
 public     | letters       | idx_letters_recipient_opcode_status       | CREATE INDEX idx_letters_recipient_opcode_status ON public.letters USING btree (recipient_op_code, status) WHERE ((recipient_op_code)::text <> ''::text)
 public     | letters       | idx_letters_reply_to_created              | CREATE INDEX idx_letters_reply_to_created ON public.letters USING btree (reply_to, created_at DESC) WHERE ((reply_to)::text <> ''::text)
 public     | letters       | idx_letters_sender_opcode_created         | CREATE INDEX idx_letters_sender_opcode_created ON public.letters USING btree (sender_op_code, created_at DESC) WHERE ((sender_op_code)::text <> ''::text)
 public     | letters       | idx_letters_type_visibility_created       | CREATE INDEX idx_letters_type_visibility_created ON public.letters USING btree (type, visibility, created_at DESC)
 public     | letters       | idx_letters_user_status_created           | CREATE INDEX idx_letters_user_status_created ON public.letters USING btree (user_id, status, created_at DESC)
 public     | status_logs   | idx_status_logs_letter_status_created     | CREATE INDEX idx_status_logs_letter_status_created ON public.status_logs USING btree (letter_id, status, created_at DESC)
 public     | status_logs   | idx_status_logs_updated_by_created        | CREATE INDEX idx_status_logs_updated_by_created ON public.status_logs USING btree (updated_by, created_at DESC) WHERE ((updated_by)::text <> ''::text)
 public     | users         | idx_users_created_role                    | CREATE INDEX idx_users_created_role ON public.users USING btree (created_at DESC, role) WHERE (deleted_at IS NULL)
 public     | users         | idx_users_role_school_active              | CREATE INDEX idx_users_role_school_active ON public.users USING btree (role, school_code, is_active) WHERE (is_active = true)
(31 rows)

 schemaname |      tablename      |                indexname                 |                                                                                                          indexdef                                                                                                           
------------+---------------------+------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 public     | courier_tasks       | idx_courier_tasks_current_opcode_status  | CREATE INDEX idx_courier_tasks_current_opcode_status ON public.courier_tasks USING btree (current_op_code, status) WHERE ((current_op_code)::text <> ''::text)
 public     | courier_tasks       | idx_courier_tasks_deadline_status        | CREATE INDEX idx_courier_tasks_deadline_status ON public.courier_tasks USING btree (deadline, status) WHERE (deadline IS NOT NULL)
 public     | courier_tasks       | idx_courier_tasks_geo_routing            | CREATE INDEX idx_courier_tasks_geo_routing ON public.courier_tasks USING btree (pickup_op_code, delivery_op_code, status, priority) WHERE (((pickup_op_code)::text <> ''::text) AND ((delivery_op_code)::text <> ''::text))
 public     | courier_tasks       | idx_courier_tasks_pickup_delivery_opcode | CREATE INDEX idx_courier_tasks_pickup_delivery_opcode ON public.courier_tasks USING btree (pickup_op_code, delivery_op_code) WHERE (((pickup_op_code)::text <> ''::text) AND ((delivery_op_code)::text <> ''::text))
 public     | couriers            | idx_couriers_active_hierarchy            | CREATE INDEX idx_couriers_active_hierarchy ON public.couriers USING btree (parent_id, level, created_at DESC) WHERE (((status)::text = 'approved'::text) AND (deleted_at IS NULL))
 public     | couriers            | idx_couriers_created_by_time             | CREATE INDEX idx_couriers_created_by_time ON public.couriers USING btree (created_by_id, created_at DESC) WHERE (created_by_id IS NOT NULL)
 public     | couriers            | idx_couriers_level_zone_active           | CREATE INDEX idx_couriers_level_zone_active ON public.couriers USING btree (level, zone_code, deleted_at) WHERE (deleted_at IS NULL)
 public     | couriers            | idx_couriers_managed_prefix_level        | CREATE INDEX idx_couriers_managed_prefix_level ON public.couriers USING btree (managed_op_code_prefix, level) WHERE ((managed_op_code_prefix)::text <> ''::text)
 public     | couriers            | idx_couriers_parent_level                | CREATE INDEX idx_couriers_parent_level ON public.couriers USING btree (parent_id, level) WHERE (parent_id IS NOT NULL)
 public     | couriers            | idx_couriers_status_level                | CREATE INDEX idx_couriers_status_level ON public.couriers USING btree (status, level, deleted_at) WHERE (deleted_at IS NULL)
 public     | credit_transactions | idx_credit_transactions_expired_at       | CREATE INDEX idx_credit_transactions_expired_at ON public.credit_transactions USING btree (expired_at) WHERE (expired_at IS NOT NULL)
 public     | letter_codes        | idx_letter_codes_bound_delivered         | CREATE INDEX idx_letter_codes_bound_delivered ON public.letter_codes USING btree (bound_at, delivered_at) WHERE (bound_at IS NOT NULL)
 public     | letter_codes        | idx_letter_codes_envelope_status         | CREATE INDEX idx_letter_codes_envelope_status ON public.letter_codes USING btree (envelope_id, status) WHERE ((envelope_id)::text <> ''::text)
 public     | letter_codes        | idx_letter_codes_recipient_code_status   | CREATE INDEX idx_letter_codes_recipient_code_status ON public.letter_codes USING btree (recipient_code, status) WHERE ((recipient_code)::text <> ''::text)
 public     | letter_codes        | idx_letter_codes_scanned_by_time         | CREATE INDEX idx_letter_codes_scanned_by_time ON public.letter_codes USING btree (last_scanned_by, last_scanned_at DESC) WHERE ((last_scanned_by)::text <> ''::text)
 public     | letters             | idx_letters_active_drafts                | CREATE INDEX idx_letters_active_drafts ON public.letters USING btree (user_id, updated_at DESC) WHERE (((status)::text = 'draft'::text) AND (deleted_at IS NULL))
 public     | letters             | idx_letters_complex_search               | CREATE INDEX idx_letters_complex_search ON public.letters USING btree (user_id, status, visibility, created_at DESC) WHERE (deleted_at IS NULL)
 public     | letters             | idx_letters_in_transit                   | CREATE INDEX idx_letters_in_transit ON public.letters USING btree (recipient_op_code, updated_at DESC) WHERE ((status)::text = ANY ((ARRAY['collected'::character varying, 'in_transit'::character varying])::text[]))
 public     | letters             | idx_letters_recipient_opcode_status      | CREATE INDEX idx_letters_recipient_opcode_status ON public.letters USING btree (recipient_op_code, status) WHERE ((recipient_op_code)::text <> ''::text)
 public     | letters             | idx_letters_reply_to_created             | CREATE INDEX idx_letters_reply_to_created ON public.letters USING btree (reply_to, created_at DESC) WHERE ((reply_to)::text <> ''::text)
 public     | letters             | idx_letters_sender_opcode_created        | CREATE INDEX idx_letters_sender_opcode_created ON public.letters USING btree (sender_op_code, created_at DESC) WHERE ((sender_op_code)::text <> ''::text)
 public     | status_logs         | idx_status_logs_updated_by_created       | CREATE INDEX idx_status_logs_updated_by_created ON public.status_logs USING btree (updated_by, created_at DESC) WHERE ((updated_by)::text <> ''::text)
 public     | users               | idx_users_created_role                   | CREATE INDEX idx_users_created_role ON public.users USING btree (created_at DESC, role) WHERE (deleted_at IS NULL)
 public     | users               | idx_users_role_school_active             | CREATE INDEX idx_users_role_school_active ON public.users USING btree (role, school_code, is_active) WHERE (is_active = true)
(24 rows)

psql:scripts/analyze_indexes_fixed.sql:132: ERROR:  column s.tablename does not exist
LINE 3:     s.tablename,
            ^
  table_name  | column_name  | foreign_table_name | foreign_column_name |                                  suggested_index                                  
--------------+--------------+--------------------+---------------------+-----------------------------------------------------------------------------------
 envelopes    | design_id    | envelope_designs   | id                  | CREATE INDEX idx_envelopes_design_id ON public.envelopes (design_id);
 museum_items | approved_by  | users              | id                  | CREATE INDEX idx_museum_items_approved_by ON public.museum_items (approved_by);
 museum_items | source_id    | letters            | id                  | CREATE INDEX idx_museum_items_source_id ON public.museum_items (source_id);
 museum_items | submitted_by | users              | id                  | CREATE INDEX idx_museum_items_submitted_by ON public.museum_items (submitted_by);
(4 rows)

psql:scripts/analyze_indexes_fixed.sql:187: ERROR:  column s.tablename does not exist
LINE 3:     s.tablename,
            ^
psql:scripts/analyze_indexes_fixed.sql:214: ERROR:  column s.tablename does not exist
LINE 3:     s.tablename,
            ^
            analysis             |                    description                    
---------------------------------+---------------------------------------------------
 Common Query Patterns Analysis: | Based on the models and typical application usage
(1 row)

 table_name  |                     query_pattern                     |                              existing_indexes                               |                             recommendation                             
-------------+-------------------------------------------------------+-----------------------------------------------------------------------------+------------------------------------------------------------------------
 users table | Common queries: by username, email, school_code, role | Existing: username, email, school_code, op_code, role+school_code+is_active | Recommendation: Add index on (is_active, created_at) for user listings
(1 row)

  table_name   |                            query_pattern                             |                        existing_indexes                        |            recommendation             
---------------+----------------------------------------------------------------------+----------------------------------------------------------------+---------------------------------------
 letters table | Common queries: by user_id+status, recipient_op_code, sender_op_code | Existing: Multiple composite indexes covering various patterns | Well-indexed table with good coverage
(1 row)

     table_name     |       query_pattern        |         existing_indexes          |          recommendation           
--------------------+----------------------------+-----------------------------------+-----------------------------------
 user_credits table | Common queries: by user_id | Existing: unique index on user_id | Well-indexed for primary use case
(1 row)

        table_name         |                   query_pattern                    |             existing_indexes              |                              recommendation                               
---------------------------+----------------------------------------------------+-------------------------------------------+---------------------------------------------------------------------------
 credit_transactions table | Common queries: by user_id, expires_at, is_expired | Existing: user_id, expires_at, is_expired | Consider composite index on (user_id, created_at) for transaction history
(1 row)

