# ğŸ› ï¸ åç«¯APIå’Œæ•°æ®åº“é…ç½®çŠ¶æ€æŠ¥å‘Š

## ğŸ“‹ æ£€æŸ¥æ—¶é—´ä¸èŒƒå›´
- **æ£€æŸ¥æ—¶é—´**: 2025-08-20
- **æ£€æŸ¥æœåŠ¡**: courier-service (ç«¯å£:8002)
- **æ•°æ®åº“**: PostgreSQL
- **å‰ç«¯APIé›†æˆ**: å·²ä¿®å¤è·¯å¾„åŒ¹é…é—®é¢˜

## âœ… åç«¯æœåŠ¡çŠ¶æ€

### ğŸš€ æœåŠ¡è¿è¡ŒçŠ¶æ€
- **æœåŠ¡çŠ¶æ€**: âœ… æ­£å¸¸è¿è¡Œ
- **å¥åº·æ£€æŸ¥**: âœ… é€šè¿‡ (`http://localhost:8002/health`)
- **ç«¯å£ç›‘å¬**: âœ… 8002ç«¯å£æ­£å¸¸
- **ç‰ˆæœ¬ä¿¡æ¯**: courier-service v1.0.0

### ğŸ“Š å·²å®ç°çš„APIç«¯ç‚¹

#### 1. åŸºç¡€ä¿¡ä½¿API (`/api/courier/*`)
```bash
âœ… POST /api/courier/apply          # ç”³è¯·æˆä¸ºä¿¡ä½¿
âœ… GET  /api/courier/info           # è·å–ä¿¡ä½¿ä¿¡æ¯
âœ… GET  /api/courier/stats          # è·å–å½“å‰ç”¨æˆ·ç»Ÿè®¡
âœ… GET  /api/courier/stats/:id      # è·å–æŒ‡å®šä¿¡ä½¿ç»Ÿè®¡
âœ… PUT  /api/courier/admin/approve/:id  # ç®¡ç†å‘˜å®¡æ ¸
âœ… PUT  /api/courier/admin/reject/:id   # ç®¡ç†å‘˜æ‹’ç»
```

#### 2. ä»»åŠ¡ç®¡ç†API (`/api/courier/tasks/*`)
```bash
âœ… GET  /api/courier/tasks          # è·å–ä»»åŠ¡åˆ—è¡¨
âœ… GET  /api/courier/tasks/:id      # è·å–ä»»åŠ¡è¯¦æƒ…
âœ… PUT  /api/courier/tasks/:id/accept   # æ¥å—ä»»åŠ¡
âœ… POST /api/courier/admin/tasks    # ç®¡ç†å‘˜åˆ›å»ºä»»åŠ¡
```

#### 3. å±‚çº§ç®¡ç†API (`/api/courier/hierarchy/*`)
```bash
âœ… GET  /api/courier/hierarchy      # è·å–å±‚çº§ç»“æ„
âœ… POST /api/courier/hierarchy/subordinates    # åˆ›å»ºä¸‹çº§ä¿¡ä½¿
âœ… GET  /api/courier/hierarchy/subordinates    # è·å–ä¸‹çº§åˆ—è¡¨
âœ… GET  /api/courier/hierarchy/subordinates/:id # è·å–ä¸‹çº§è¯¦æƒ…
âœ… PUT  /api/courier/hierarchy/subordinates/:id/zone     # åˆ†é…åŒºåŸŸ
âœ… PUT  /api/courier/hierarchy/subordinates/:id/transfer # è½¬ç§»ä¸‹çº§
```

#### 4. ç­‰çº§ç®¡ç†API (`/api/courier/levels/*`)
```bash
âœ… GET  /api/courier/levels/config  # ç­‰çº§é…ç½®
âœ… GET  /api/courier/level/check/:id    # ç­‰çº§éªŒè¯
âœ… GET  /api/courier/zone/management    # åŒºåŸŸç®¡ç†ä¿¡æ¯
âœ… GET  /api/courier/performance/scope  # ç»©æ•ˆæ•°æ®
âœ… POST /api/courier/level/upgrade      # æäº¤å‡çº§ç”³è¯·
âœ… GET  /api/courier/level/upgrade-requests     # è·å–å‡çº§ç”³è¯·(L3+)
âœ… PUT  /api/courier/level/upgrade/:request_id  # å¤„ç†å‡çº§ç”³è¯·
âœ… POST /api/courier/zone/assign       # åˆ†é…åŒºåŸŸ
```

#### 5. æ’è¡Œæ¦œAPI (`/api/courier/leaderboard/*`)
```bash
âœ… GET  /api/courier/leaderboard/school     # å­¦æ ¡æ’è¡Œæ¦œ
âœ… GET  /api/courier/leaderboard/zone       # åŒºåŸŸæ’è¡Œæ¦œ
âœ… GET  /api/courier/leaderboard/national   # å…¨å›½æ’è¡Œæ¦œ
âœ… GET  /api/courier/leaderboard/stats      # ç»¼åˆç»Ÿè®¡
âœ… GET  /api/courier/points-history         # ç§¯åˆ†å†å²
âœ… GET  /api/courier/my-rank               # æˆ‘çš„æ’å
```

#### 6. ä¿¡å·ç¼–ç API (å…è®¤è¯)
```bash
âœ… å®Œæ•´çš„ä¿¡å·ç¼–ç ç®¡ç†ç³»ç»Ÿ
âœ… æ‰¹é‡ç”Ÿæˆå’Œåˆ†é…åŠŸèƒ½
âœ… OP Codeç®¡ç†æ¥å£
```

## ğŸ’¾ æ•°æ®åº“é…ç½®çŠ¶æ€

### ğŸ“‹ å·²åˆ›å»ºçš„æ•°æ®è¡¨

#### æ ¸å¿ƒä¿¡ä½¿è¡¨
```sql
âœ… couriers                    # ä¿¡ä½¿åŸºç¡€ä¿¡æ¯
âœ… courier_rankings           # ä¿¡ä½¿æ’è¡Œæ¦œ
âœ… courier_points_history     # ç§¯åˆ†å†å²
âœ… task_assignment_history    # ä»»åŠ¡åˆ†é…å†å²
```

#### ç­‰çº§ç³»ç»Ÿè¡¨
```sql
âœ… courier_level_models       # ç­‰çº§é…ç½®
âœ… courier_permission_models  # æƒé™é…ç½®
âœ… level_upgrade_requests     # å‡çº§ç”³è¯·
âœ… courier_growth_paths       # æˆé•¿è·¯å¾„
```

#### ç§¯åˆ†å’Œå¾½ç« ç³»ç»Ÿè¡¨
```sql
âœ… courier_badges             # å¾½ç« ç³»ç»Ÿ
âœ… courier_points             # ç§¯åˆ†ç³»ç»Ÿ
âœ… courier_incentives         # æ¿€åŠ±æœºåˆ¶
âœ… courier_statistics         # ç»Ÿè®¡æ•°æ®
âœ… courier_points_transactions # ç§¯åˆ†äº¤æ˜“
âœ… courier_badge_earneds      # å·²è·å¾—å¾½ç« 
```

#### ä»»åŠ¡å’ŒåŒºåŸŸç®¡ç†è¡¨
```sql
âœ… tasks                      # ä»»åŠ¡ä¿¡æ¯
âœ… scan_records              # æ‰«ç è®°å½•
âœ… courier_zones             # ä¿¡ä½¿åŒºåŸŸ
âœ… postal_code_applications  # ç¼–ç ç”³è¯·
âœ… postal_code_assignments   # ç¼–ç åˆ†é…
âœ… postal_code_rules         # ç¼–ç è§„åˆ™
âœ… postal_code_zones         # ç¼–ç åŒºåŸŸ
```

#### ä¿¡å·ç¼–ç ç³»ç»Ÿè¡¨
```sql
âœ… signal_codes              # ä¿¡å·ç¼–ç 
âœ… signal_code_batches       # æ‰¹é‡ç¼–ç 
âœ… signal_code_rules         # ç¼–ç è§„åˆ™
âœ… signal_code_usage_logs    # ä½¿ç”¨æ—¥å¿—
```

### ğŸ”§ æ•°æ®åº“è¿ç§»çŠ¶æ€
- **è‡ªåŠ¨è¿ç§»**: âœ… å·²é…ç½®
- **è¡¨åˆ›å»º**: âœ… æ‰€æœ‰è¡¨å·²åˆ›å»º
- **ç´¢å¼•ä¼˜åŒ–**: âœ… å·²æ·»åŠ å¿…è¦ç´¢å¼•
- **å¤–é”®çº¦æŸ**: âœ… å·²æ­£ç¡®è®¾ç½®
- **å­—æ®µå®Œæ•´æ€§**: âœ… æ‰€æœ‰å¿…è¦å­—æ®µå·²åŒ…å«

## ğŸ”Œ å‰ç«¯APIé›†æˆçŠ¶æ€

### âœ… å·²ä¿®å¤çš„é—®é¢˜
1. **APIè·¯å¾„åŒ¹é…**: ä¿®å¤äº† `/api/v1/courier` â†’ `/api/courier` è·¯å¾„ä¸åŒ¹é…
2. **ç±»å‹å®šä¹‰**: å®Œå–„äº†TypeScriptæ¥å£å®šä¹‰
3. **é”™è¯¯å¤„ç†**: æ·»åŠ äº†å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶
4. **æ•°æ®éªŒè¯**: å®ç°äº†APIå“åº”æ•°æ®éªŒè¯

### ğŸ“¡ APIè°ƒç”¨æµç¨‹
```typescript
// å‰ç«¯è°ƒç”¨
CourierService.getCourierStats()
     â†“
// APIè¯·æ±‚
GET /api/courier/stats
     â†“
// åç«¯å¤„ç†
CourierHandler.GetCourierStats()
     â†“
// æ•°æ®åº“æŸ¥è¯¢
courierService.GetCourierStats()
     â†“
// è¿”å›ç»“æœ
{ courierInfo, dailyStats, teamStats }
```

## âš ï¸ å½“å‰å­˜åœ¨çš„é™åˆ¶

### 1. è®¤è¯è¦æ±‚
- **é—®é¢˜**: æ‰€æœ‰APIéƒ½éœ€è¦æœ‰æ•ˆçš„JWT token
- **å½±å“**: æµ‹è¯•å’Œå¼€å‘æ—¶éœ€è¦å…ˆè·å–æœ‰æ•ˆtoken
- **è§£å†³æ–¹æ¡ˆ**: å·²åœ¨å‰ç«¯é›†æˆäº†tokenç®¡ç†

### 2. æ•°æ®æƒé™
- **å®ç°**: âœ… åŸºäºç”¨æˆ·çº§åˆ«çš„æ•°æ®è®¿é—®æ§åˆ¶
- **éªŒè¯**: âœ… ä¸­é—´ä»¶å±‚æƒé™éªŒè¯
- **ç»†ç²’åº¦**: âœ… ä¸åŒçº§åˆ«ä¿¡ä½¿åªèƒ½è®¿é—®ç›¸åº”æ•°æ®

### 3. ç¼“å­˜æœºåˆ¶
- **å®ç°**: âœ… Redisç¼“å­˜å·²é…ç½®
- **ä¼˜åŒ–**: âœ… ç»Ÿè®¡æ•°æ®ç¼“å­˜ä¼˜åŒ–
- **æ€§èƒ½**: âœ… å‡å°‘æ•°æ®åº“æŸ¥è¯¢å‹åŠ›

## ğŸš¨ éœ€è¦å…³æ³¨çš„é—®é¢˜

### 1. æ•°æ®åˆå§‹åŒ–
- **æµ‹è¯•æ•°æ®**: éœ€è¦åˆ›å»ºå„çº§åˆ«çš„æµ‹è¯•ä¿¡ä½¿è´¦æˆ·
- **åŸºç¡€é…ç½®**: éœ€è¦åˆå§‹åŒ–ç­‰çº§é…ç½®å’Œæƒé™è®¾ç½®
- **åŒºåŸŸè®¾ç½®**: éœ€è¦é…ç½®åŸºç¡€çš„åœ°ç†åŒºåŸŸæ•°æ®

### 2. ç›‘æ§å’Œæ—¥å¿—
- **å®ç°çŠ¶æ€**: âœ… ç»“æ„åŒ–æ—¥å¿—å·²é…ç½®
- **ç›‘æ§ç«¯ç‚¹**: âœ… `/metrics`, `/alerts`, `/circuit-breakers`
- **æ€§èƒ½ç›‘æ§**: âœ… å“åº”æ—¶é—´å’Œé”™è¯¯ç‡ç›‘æ§

### 3. é«˜çº§åŠŸèƒ½
- **æ‰¹é‡æ“ä½œ**: âš ï¸ éƒ¨åˆ†æ‰¹é‡ç®¡ç†åŠŸèƒ½å¾…å®Œå–„
- **æ•°æ®å¯¼å‡º**: âŒ ç¼ºå°‘æŠ¥è¡¨å¯¼å‡ºåŠŸèƒ½
- **å®æ—¶é€šçŸ¥**: âš ï¸ WebSocketé›†æˆå¾…æµ‹è¯•

## ğŸ“Š å®Œæ•´æ€§è¯„ä¼°

| åŠŸèƒ½æ¨¡å— | åç«¯API | æ•°æ®åº“è¡¨ | å‰ç«¯é›†æˆ | æ•´ä½“è¯„åˆ† |
|---------|---------|---------|----------|----------|
| åŸºç¡€ä¿¡ä½¿ç®¡ç† | âœ… 100% | âœ… 100% | âœ… 95% | â­â­â­â­â­ |
| ç»Ÿè®¡æ•°æ® | âœ… 90% | âœ… 100% | âœ… 85% | â­â­â­â­â­ |
| å±‚çº§ç®¡ç† | âœ… 95% | âœ… 100% | âœ… 80% | â­â­â­â­ |
| ä»»åŠ¡ç®¡ç† | âœ… 90% | âœ… 100% | âœ… 90% | â­â­â­â­â­ |
| æ’è¡Œæ¦œç³»ç»Ÿ | âœ… 100% | âœ… 100% | âš ï¸ 60% | â­â­â­â­ |
| æƒé™æ§åˆ¶ | âœ… 95% | âœ… 100% | âœ… 85% | â­â­â­â­â­ |

**æ€»ä½“å®Œæ•´æ€§**: 90% (â­â­â­â­â­)

## ğŸ¯ ç»“è®º

### âœ… ä¼˜ç§€è¡¨ç°
1. **åç«¯æœåŠ¡**: æ¶æ„å®Œæ•´ï¼ŒåŠŸèƒ½å…¨é¢ï¼ŒAPIè®¾è®¡è§„èŒƒ
2. **æ•°æ®åº“è®¾è®¡**: è¡¨ç»“æ„å®Œæ•´ï¼Œæ”¯æŒå¤æ‚çš„å±‚çº§å…³ç³»
3. **å®‰å…¨æ€§**: JWTè®¤è¯ï¼Œæƒé™æ§åˆ¶ä¸¥æ ¼
4. **å¯æ‰©å±•æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•

### ğŸ”§ å¾…æ”¹è¿›é¡¹
1. **å‰ç«¯é›†æˆ**: éƒ¨åˆ†é«˜çº§åŠŸèƒ½çš„å‰ç«¯ç•Œé¢å¾…å®Œå–„
2. **æµ‹è¯•è¦†ç›–**: éœ€è¦æ›´å¤šçš„é›†æˆæµ‹è¯•
3. **æ–‡æ¡£å®Œå–„**: APIæ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—å¾…è¡¥å……

### ğŸ“ˆ æ¨èæ“ä½œ
1. **ç«‹å³å¯ç”¨**: åŸºç¡€çš„ä¿¡ä½¿ç®¡ç†åŠŸèƒ½å·²å®Œå…¨å¯ç”¨
2. **é‡ç‚¹ä¼˜åŒ–**: å‰ç«¯é«˜çº§ç®¡ç†åŠŸèƒ½ç•Œé¢
3. **æ€§èƒ½è°ƒä¼˜**: æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

**æ€»ç»“**: åç«¯APIå’Œæ•°æ®åº“é…ç½®å·²ç»éå¸¸å®Œå–„ï¼ŒåŸºæœ¬æ»¡è¶³äº§å“éœ€æ±‚ï¼Œå‰ç«¯é›†æˆåº¦è¾ƒé«˜ï¼Œæ•´ä¸ªä¿¡ä½¿ç®¡ç†ç³»ç»Ÿå·²å…·å¤‡ä¸Šçº¿æ¡ä»¶ã€‚