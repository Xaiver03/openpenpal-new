# JVM Tuning Configuration for OpenPenPal Admin Service
# This configuration optimizes JVM settings to prevent GC pauses that could
# interfere with HikariCP connection pool management.

# Memory Settings (adjust based on available system memory)
-Xms2g
-Xmx2g
-XX:MetaspaceSize=256m
-XX:MaxMetaspaceSize=512m

# Garbage Collection Settings
# Use G1GC for low-pause, high-throughput garbage collection
-XX:+UseG1GC
-XX:MaxGCPauseMillis=200
-XX:G1HeapRegionSize=16m
-XX:G1NewSizePercent=30
-XX:G1MaxNewSizePercent=40
-XX:ParallelGCThreads=8
-XX:ConcGCThreads=2
-XX:InitiatingHeapOccupancyPercent=45

# Memory Management
-XX:+AlwaysPreTouch
-XX:+UseTransparentHugePages
-XX:+DisableExplicitGC

# Performance Optimization
-XX:+ParallelRefProcEnabled
-XX:+UseStringDeduplication
-XX:-UseBiasedLocking

# Debugging and Monitoring
-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath=/var/log/openpenpal/admin-service/
-XX:+PrintGC
-XX:+PrintGCDetails
-XX:+PrintGCTimeStamps
-XX:+PrintGCApplicationStoppedTime
-XX:+UseGCLogFileRotation
-XX:NumberOfGCLogFiles=5
-XX:GCLogFileSize=100M
-Xloggc:/var/log/openpenpal/admin-service/gc.log

# JMX for monitoring
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.port=9999
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.ssl=false

# Security
-Djava.security.egd=file:/dev/./urandom

# Network Settings
-Djava.net.preferIPv4Stack=true
-Dfile.encoding=UTF-8

# Application Specific
-Dspring.profiles.active=production
-Djava.awt.headless=true

# Flight Recorder (for Java 11+)
-XX:+FlightRecorder
-XX:FlightRecorderOptions=defaultrecording=true,disk=true,repository=/var/log/openpenpal/admin-service/jfr,dumponexit=true,dumponexitpath=/var/log/openpenpal/admin-service/jfr