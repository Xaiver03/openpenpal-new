# OpenPenPal è§’è‰²ç³»ç»Ÿå…¨é¢æ›´æ–°è®¡åˆ’

> ç”Ÿæˆæ—¶é—´: 2025-08-09
> ç›®æ ‡: ç»Ÿä¸€å‰åç«¯è§’è‰²ç³»ç»Ÿï¼Œä¸¥æ ¼éµå¾ªPRDè®¾è®¡

## ğŸ“Š å½“å‰çŠ¶æ€åˆ†æ

### å‘ç°çš„é—®é¢˜

1. **åç«¯é—®é¢˜**
   - âœ… `user.go` å·²æ›´æ–°è§’è‰²å®šä¹‰
   - âŒ `database.go` åŒ…å«æ—§è§’è‰²çš„ç§å­æ•°æ®
   - âŒ å…¶ä»–æœåŠ¡æ–‡ä»¶å¯èƒ½å¼•ç”¨æ—§è§’è‰²

2. **å‰ç«¯é—®é¢˜**
   - âŒ `roles.ts` åŒ…å«æ‰€æœ‰å†—ä½™è§’è‰²å®šä¹‰
   - âŒ å‰ç«¯ç±»å‹å®šä¹‰ä¸åç«¯ä¸ä¸€è‡´

3. **æ•°æ®åº“é—®é¢˜**
   - âœ… å®é™…æ•°æ®å·²ç¬¦åˆPRDï¼ˆåªæœ‰å››çº§ä¿¡ä½¿ï¼‰
   - âŒ ç§å­æ•°æ®è„šæœ¬éœ€è¦æ›´æ–°

## ğŸ¯ ç›®æ ‡è§’è‰²ä½“ç³»

```
æ­£ç¡®çš„è§’è‰²ï¼š
- user              # æ™®é€šç”¨æˆ·
- courier_level1    # ä¸€çº§ä¿¡ä½¿ï¼ˆåŸºç¡€æŠ•é€’ä¿¡ä½¿ï¼‰
- courier_level2    # äºŒçº§ä¿¡ä½¿ï¼ˆç‰‡åŒºåè°ƒå‘˜ï¼‰  
- courier_level3    # ä¸‰çº§ä¿¡ä½¿ï¼ˆæ ¡åŒºè´Ÿè´£äººï¼‰
- courier_level4    # å››çº§ä¿¡ä½¿ï¼ˆåŸå¸‚è´Ÿè´£äººï¼‰
- platform_admin    # å¹³å°ç®¡ç†å‘˜
- super_admin       # è¶…çº§ç®¡ç†å‘˜

éœ€è¦ç§»é™¤çš„è§’è‰²ï¼š
- courier           âŒ
- senior_courier    âŒ
- courier_coordinator âŒ
- school_admin      âŒ
- admin             âŒ (ç»Ÿä¸€ä½¿ç”¨ super_admin)
```

## ğŸ“ å®æ–½æ­¥éª¤

### Step 1: åç«¯ä»£ç æ›´æ–°

#### 1.1 æ›´æ–° database.go
```go
// ç§»é™¤è¿™äº›ç”¨æˆ·
- courier (ID: 5)
- senior_courier (ID: 6)
- courier_coordinator (ID: 7)
- school_admin (ID: 8)
- courier_1 (ID: 11)
- courier_2 (ID: 12)
- courier_3 (ID: 13)

// ä¿ç•™å¹¶ç¡®ä¿æ­£ç¡®
- courier_level1 (ID: 9)
- courier_level2 (ID: 10)
- courier_level3 (ID: 3)
- courier_level4 (ID: 4)
```

#### 1.2 æ£€æŸ¥å…¶ä»–åç«¯æ–‡ä»¶
éœ€è¦æ£€æŸ¥å¹¶æ›´æ–°ï¼š
- `main.go` - è·¯ç”±æƒé™æ£€æŸ¥
- `courier_service.go` - ä¿¡ä½¿æœåŠ¡é€»è¾‘
- `websocket/client.go` - WebSocketæƒé™
- `role_mapping.go` - è§’è‰²æ˜ å°„

### Step 2: å‰ç«¯ä»£ç æ›´æ–°

#### 2.1 ç®€åŒ– roles.ts
```typescript
export type UserRole = 
  | 'user'
  | 'courier_level1'
  | 'courier_level2'
  | 'courier_level3'
  | 'courier_level4'
  | 'platform_admin'
  | 'super_admin'
```

#### 2.2 æ›´æ–°ç»„ä»¶
- ç§»é™¤å¯¹æ—§è§’è‰²çš„å¼•ç”¨
- æ›´æ–°æƒé™æ£€æŸ¥é€»è¾‘
- ç¡®ä¿å¯¼èˆªèœå•æ­£ç¡®

### Step 3: æ•°æ®è¿ç§»

#### 3.1 æ•°æ®åº“è¿ç§»SQL
```sql
-- å¦‚æœæœ‰ä½¿ç”¨æ—§è§’è‰²çš„ç”¨æˆ·
UPDATE users SET role = 'courier_level1' WHERE role = 'courier';
UPDATE users SET role = 'courier_level2' WHERE role = 'senior_courier';
UPDATE users SET role = 'courier_level2' WHERE role = 'courier_coordinator';
UPDATE users SET role = 'courier_level3' WHERE role = 'school_admin';
UPDATE users SET role = 'super_admin' WHERE role = 'admin';
```

### Step 4: æµ‹è¯•éªŒè¯

#### 4.1 åŠŸèƒ½æµ‹è¯•
- [ ] å„è§’è‰²ç™»å½•æµ‹è¯•
- [ ] æƒé™è®¿é—®æµ‹è¯•
- [ ] ä¿¡ä½¿åŠŸèƒ½æµ‹è¯•
- [ ] ç®¡ç†åŠŸèƒ½æµ‹è¯•

#### 4.2 é›†æˆæµ‹è¯•
- [ ] å‰åç«¯è§’è‰²ä¸€è‡´æ€§
- [ ] APIæƒé™éªŒè¯
- [ ] WebSocketæƒé™

## ğŸš€ æ‰§è¡Œé¡ºåº

1. **Phase 1**: åç«¯æ›´æ–°ï¼ˆä¼˜å…ˆï¼‰
   - æ›´æ–°database.goç§å­æ•°æ®
   - æ£€æŸ¥å¹¶æ›´æ–°å…¶ä»–æœåŠ¡æ–‡ä»¶
   - è¿è¡Œå•å…ƒæµ‹è¯•

2. **Phase 2**: å‰ç«¯åŒæ­¥
   - æ›´æ–°roles.tsç±»å‹å®šä¹‰
   - æ›´æ–°ç»„ä»¶ä¸­çš„è§’è‰²æ£€æŸ¥
   - è¿è¡Œå‰ç«¯æµ‹è¯•

3. **Phase 3**: é›†æˆéªŒè¯
   - ç«¯åˆ°ç«¯æµ‹è¯•
   - ç”¨æˆ·ä½“éªŒæµ‹è¯•
   - æ€§èƒ½æµ‹è¯•

## âš ï¸ é£é™©ç®¡ç†

1. **å‘åå…¼å®¹æ€§**
   - ä¿ç•™è§’è‰²æ˜ å°„é€»è¾‘ä¸€æ®µæ—¶é—´
   - æä¾›æ•°æ®è¿ç§»è„šæœ¬

2. **ç”¨æˆ·å½±å“**
   - æå‰é€šçŸ¥ç”¨æˆ·è§’è‰²è°ƒæ•´
   - ç¡®ä¿æƒé™ä¸ä¼šé™çº§

3. **å›æ»šè®¡åˆ’**
   - å¤‡ä»½æ‰€æœ‰ä¿®æ”¹çš„æ–‡ä»¶
   - å‡†å¤‡å›æ»šè„šæœ¬

## ğŸ“Š é¢„æœŸç»“æœ

1. **ä»£ç ç®€åŒ–**
   - å‡å°‘50%çš„è§’è‰²å®šä¹‰ä»£ç 
   - æ›´æ¸…æ™°çš„æƒé™å±‚çº§

2. **ç»´æŠ¤æ€§æå‡**
   - ç»Ÿä¸€çš„è§’è‰²ä½“ç³»
   - æ›´å®¹æ˜“ç†è§£å’Œæ‰©å±•

3. **ç”¨æˆ·ä½“éªŒ**
   - æ›´æ¸…æ™°çš„è§’è‰²å®šä½
   - æ›´åˆç†çš„æƒé™åˆ†é…

## âœ… å®Œæˆæ ‡å‡†

- [ ] æ‰€æœ‰ä»£ç ä¸­åªå­˜åœ¨7ç§è§’è‰²
- [ ] å‰åç«¯è§’è‰²ç±»å‹å®Œå…¨ä¸€è‡´
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ
- [ ] æ²¡æœ‰åŠŸèƒ½é€€åŒ–