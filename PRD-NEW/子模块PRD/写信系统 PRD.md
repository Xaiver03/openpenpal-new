# **一、模块定位**

写信系统是用户与平台交互的起点，承载着“内容创作 + 投递引导 + 情绪表达”的功能。其本质是将用户的表达转化为可被信封条码追踪的实体信件，同时支持线上互动、匿名发布、未来定投等衍生形式。

---

# **二、核心功能结构**

|**功能模块**|**描述**|
|---|---|
|写信页面|用户输入文字、选择信纸样式、匿名/实名选项、写作标签等|
|条码生成|系统为每封信生成唯一编号及二维码，下载为PDF贴纸|
|条码绑定|用户扫码贴纸后输入收件人信息（邮编+姓名），一旦提交即完成绑定，无法更改|
|信封投递引导|告知用户可选择投递方式：宿舍信箱、合作商店、自交给信使|
|回信流程|收件人扫码查看信件后可发起回信，自动带入原信编号与地址编码|
|写作广场|公开信件发布入口，支持点赞、收藏、评论（后续版本）|
|未来信功能|用户设置未来解锁时间，平台延迟展示或发送提醒|
|漂流信功能|用户可选择“匿名漂流”，系统进入 AI 或人工漂流中转流程|

---

# **三、用户流程**

  

## **3.1 寄信流程**

```
graph TD
A[用户点击“写信”] --> B[输入内容+选择样式]
B --> C[生成编号+二维码PDF]
C --> D[打印或领取贴纸]
D --> E[粘贴条码到实体信封]
E --> F[选择投递方式 → 交至宿舍/商店/信使]
```

## **3.2 回信流程**

```
graph TD
X[收件人扫码查看信件] --> Y[点击“写回信”]
Y --> Z[自动填入原始编号+编码] --> A[进入写信页面]
```

---

# **四、功能说明细化**

  

## **条码绑定规则**

- 每封信生成唯一编号，如：OPP-BJFU-0001
    
- 条码首次扫码后进入“绑定页面”
    
- 填写：收件人姓名 + 6位 OP Code（地址编码）
    
- 一旦提交，绑定关系锁定，不可更改
    

  

## **投递引导**

- 显示附近的宿舍投递点、商店合作点、可见信使位置
    
- 用户可选择“我已投递” → 提交投递方式用于系统追踪
    

  

## **写作支持**

- 可选择信纸样式（颜色/纹理）、情绪标签（如鼓励、思念、愧疚等）
    
- 写作字数推荐：100字以上，不设上限。
    

---

# **五、权限控制**

|**操作项**|**权限用户**|
|---|---|
|写信生成条码|所有注册用户|
|回信|收件人扫码后生成|
|修改绑定信息|❌ 不允许修改，绑定后一旦提交即锁定|
|公开展示信件内容|需收寄双方均在平台确认同意|

---

# **六、数据结构（简要）**

```
Letter {
  letter_id: string,
  sender_id: string,
  content: string,
  style: string,
  tags: string[],
  is_anonymous: boolean,
  is_reply_to?: string,
  delivery_code: string,
  bind_status: "unbound" | "bound",
  created_at: timestamp
}
```

---

# **七、非功能性要求**

|**类型**|**要求**|
|---|---|
|写作体验|写信页面响应时间 ≤ 2s|
|条码生成|PDF贴纸文件≤200KB，二维码兼容手机扫码|
|隐私保护|写信人实名信息仅平台可见，信封不展示|
|安全性|条码编号加密、不可复用、绑定行为不可篡改|

---

# **八、与其他模块的依赖关系**

- **条码系统**：写信系统依赖条码生成与绑定流程；
    
- **编码系统**：需验证输入的 OP Code 是否有效；
    
- **信使系统**：投递路径与状态由信使模块记录；
    
- **信封系统**：写信必须使用平台认可的信封，附带条码贴纸；
    
- **AI系统**：写作灵感推送、匿名漂流信匹配调用 AI 模块。
    
