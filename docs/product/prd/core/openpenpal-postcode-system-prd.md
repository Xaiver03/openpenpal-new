## **一、产品名称**

OpenPenPal Postcode 地址编码系统

## **二、产品定位**

Postcode 模块是 OpenPenPal 信件物流体系的基础设施，用于为校园用户构建结构化、标准化的地址编码体系，并支撑信封投递、任务派发、地址查找与数据追踪功能。

---

## **三、使用场景与目标**

|**使用者**|**使用目的**|
|---|---|
|用户（写信人）|输入/选择收件人地址，获取正确的邮编编码|
|信使|投递信件前识别地址归属、接收投递任务、提交新片区|
|平台管理员|建立/编辑学校结构，分发权限，校验投递失败数据|
|受信人|查阅自己的邮编是否正确，或发起纠错请求|

---

## **四、编码规则**

### **📌 编码结构：6 位，分层含义如下**

|**位次**|**含义**|**示例**|**控管角色**|
|---|---|---|---|
|第1–2位|学校站点码|PK（北京大学）|四级总代|
|第3位|片区码|5（第五片区）|三级信使|
|第4位|楼栋/楼层码|F（F栋）|二级信使|
|第5–6位|房间号|3D（3D宿舍）|一级信使|

✅ 每个地址自动生成 Postcode = PK5F3D

---

## **五、功能模块**

### **5.1 用户端**

|**功能**|**描述**|
|---|---|
|Postcode 地址选择器|写信页面中支持学校 → 片区 → 楼栋 → 宿舍 级联选择|
|编码反查|输入编码 → 返回结构化地址|
|地址错误反馈|无匹配地址时允许用户提交“新增地址请求”|

---

### **5.2 信使端**

|**功能**|**描述**|
|---|---|
|权限内结构管理|信使可增补片区/楼栋/宿舍（需上级信使或平台审核）|
|投递范围查看|自动展示所拥有编码前缀下的结构清单|
|投递失败反馈|无法送达 → 提交为地址异常，平台审核修正|

---

### **5.3 管理后台模块**

| **功能** | **描述**                    |
| ------ | ------------------------- |
| 地址结构管理 | 学校 → 片区 → 楼栋 → 房间可视化编辑与导入 |
| 信使权限分配 | 支持将编码前缀（如 PK5F）分配给指定信使    |
| 新增地址审核 | 审核信使或用户提交的新增地址/错误反馈       |
| 编码使用分析 | 展示地址使用频率与活跃区域热力图（可选）      |

---

## **六、权限系统（与信使体系对接）**

|**信使等级**|**权限范围（Postcode前缀）**|**可执行操作**|
|---|---|---|
|四级信使|站点码，如 PK|新建学校、站点结构、导入宿舍数据|
|三级信使|如 PK5（片区级）|创建楼栋、管理片区结构|
|二级信使|如 PK5F（楼栋级）|编辑宿舍信息、增补房间|
|一级信使|如 PK5F3D（房间级）|投递确认、反馈无法送达|

> 所有信件投递与任务调度均基于 Postcode 前缀授权。

---

## **七、技术实现要点建议**

### **7.1 数据结构（PostgreSQL）**

- school_sites：学校与站点
    
- site_areas：片区
    
- area_buildings：楼栋
    
- building_rooms：宿舍（含 full_postcode）

### **7.2 API 接口（Go）**

|**接口**|**方法**|**路径**|
|---|---|---|
|查询编码地址|GET|/api/postcode/:code|
|地址选择推荐|GET|/api/address/search?q=|
|新增结构提交|POST|/api/address/new|
|异常地址反馈|POST|/api/postcode/feedback|
|获取权限范围结构|GET|/api/postcode/tree?courier_id=|

---

## **八、关键指标（KPI）**

|**指标**|**成功标准**|
|---|---|
|地址选择准确率|90% 用户可成功选择完整编码|
|信使任务匹配成功率|95% 投递任务正确分配至对应信使|
|地址异常响应时效|48小时内完成审核/补录|
|编码唯一性错误率|≤ 0.1%（通过结构递归校验实现）|

---

## **九、版本计划**

|**版本**|**功能重点**|
|---|---|
|V1.0（MVP）|编码结构建模 + 地址选择器 + 信使权限管理|
|V1.1|投递失败自动归因 + 用户侧结构推荐改进|
|V1.2|地址热力分析、地图可视化与批量导入|

---

如你确认，我可以继续输出以下内容：

- ✅ 数据库建表 SQL 文件
    
- ✅ Swagger 接口文档
    
- ✅ 地址选择器组件设计稿
    
- ✅ 管理后台 UI 草图

是否继续？你希望我优先生成哪部分内容？