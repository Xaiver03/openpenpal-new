## **一、模块定位**

  

OpenPenPal 编码系统（简称 OP Code）是整个平台物流与点位识别的核心地理标识体系。每一个具体的投递目标（如宿舍、商店）都以一个**6位编码**作为其地址身份，通过结构化管理实现标准化、隐私保护与任务授权。

---

## **二、编码结构**

|**位数**|**含义**|**示例**|**维护者**|**是否公开**|
|---|---|---|---|---|
|前1–2位|学校代码|PK|四级信使（城市）|✅|
|第3–4位|校内片区/宿舍楼栋|5F|三级信使（学校）|✅|
|第5–6位|宿舍门牌/店铺点位|3D|二级信使/用户|条件公开|

完整编码示例：PK5F3D 表示北京林业大学五号楼3D宿舍

---

## **三、使用场景**

|**场景**|**描述**|
|---|---|
|信件收件地址标注|所有信件条码需绑定收件人的 OP Code|
|信封绑定/扫码|条码首次扫码绑定时需填写目标 OP Code|
|信使任务范围定义|信使只能领取自己编码段落下的任务（如PK5F*）|
|用户设置投递点|若用户想将自己宿舍设为可接收点 → 提交编码申请并绑定|
|公共投递点管理|商店、投递箱需申请成为开放点位，并以编码方式呈现|
|隐私保护机制|前4位可公开查询，后2位可设为仅信使可见|

---

## **四、编码申请与授权机制**

  

### **4.1 用户侧流程（以宿舍为例）**

```
graph TD
A[用户选择设宿舍为接收点] --> B[系统自动生成PK5F+00]
B --> C[点击“申请绑定点位编码”]
C --> D[填写信息 → 提交申请]
D --> E[二级信使审核]
E --> F[审核通过 → 生成唯一后两位编码]
```

说明：

- 初始注册仅要求填写前4位（即可识别学校与片区）
    
- 用户可主动申请使用后两位创建/绑定具体点位
    
- 审核通过后，系统生成唯一地址编码并与该用户宿舍绑定
    

---

## **五、编码管理后台功能**

|**功能**|**权限人群**|**描述**|
|---|---|---|
|编码段开放控制|四级/三级信使|控制是否开放新学校、是否支持新片区、限制后两位绑定数量|
|点位编码审核与分配|二级信使|审核用户提交的宿舍/店铺点位绑定申请，确认无冲突后发放编码|
|编码查询工具|所有用户|输入学校/片区信息，可查询前四位编码及开放状态|
|地址去识别机制|平台系统自动机制|隐藏后两位编码，仅投递信使可见（非公开场景）|
|投递授权逻辑|系统+信使任务系统集成|某信使是否能看见/派送某编码区域由所属编码段控制|

---

## **六、点位类型说明**

|**类型**|**举例**|**是否公开**|**授权逻辑**|
|---|---|---|---|
|宿舍|北林5F3D|否|仅任务信使可见|
|商店|小白楼文具铺|是|所有用户可见，可主动选择|
|投递箱|教三南门投递点|是|系统统一展示|
|社团空间|书法协会信箱|可选|经审核后开放/隐藏|

---

## **七、编码样式建议与规范**

- 所有编码为6位结构，前两位大写字母 + 后四位数字/字母混合
    
- 不能包含空格、特殊符号、重复段
    
- 商店与宿舍不能使用重复编码，系统校验冲突自动驳回
    

---

## **八、权限控制**

|**操作项**|**权限角色**|
|---|---|
|开通学校前两位编码|四级信使|
|维护宿舍片区三四位编码|三级信使|
|审核/分配宿舍或商店编码（5-6位）|二级信使|
|查询用户OP Code|用户本人 / 信使任务授权范围内可见|
|公开展示店铺/开放点编码|平台审核通过后所有人可查|

---

## **九、非功能性要求**

|**类别**|**要求**|
|---|---|
|唯一性验证|所有编码系统查重，防止冲突|
|权限隔离|每级信使仅能操作/管理自己负责的段|
|安全性|点位绑定不可私下转移，必须申请更换|
|审计记录|编码分配、变更、查询行为均记录操作日志|

---

## **十、与其他模块接口**

|**模块**|**描述**|
|---|---|
|条码系统|条码绑定/任务调度依赖编码识别和校验|
|写信系统|用户需输入收件人编码或从通讯录中选择编码地址|
|信使系统|任务授权范围基于编码范围控制（如“PK5F*”）|
|信封系统|校园/城市信封设计与发行亦可基于编码片区定制|
|AI系统|匿名漂流匹配时编码可作为地域调节参数|
