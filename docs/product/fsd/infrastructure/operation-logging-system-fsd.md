## **一、模块定位**

  

操作日志系统是平台的“黑匣子”，记录所有敏感或关键操作事件，包括用户、信使、管理员行为，如：

- ✅ 信件生成/查看/回信
    
- ✅ 条码激活/绑定/作废
    
- ✅ 编码注册/投递点申请
    
- ✅ 信封设计上传/审核决策
    
- ✅ AI内容生成/用户反馈
    
- ✅ 管理员变更配置或权限
    

  

目标是：**可追溯 / 可稽核 / 可恢复 / 可告警**。

---

## **二、日志分类结构**

|**日志类型**|**描述**|**主体**|
|---|---|---|
|用户操作日志|写信、扫码、上传照片、回信、匿名设置等|user|
|信使任务日志|接单、扫码投递、更新任务状态、点位操作等|messenger|
|管理后台日志|配置变更、权限调整、信封采纳、公告发布等|admin|
|系统行为日志|条码自动生成、AI自动分发、模块开关等|system daemon|

---

## **三、字段设计**

```
OperationLog {
  id: string;
  actor_id: string;         // 用户或系统ID
  actor_role: "user" | "messenger" | "admin" | "system";
  action: string;           // 操作类型，如 "generate_letter" / "assign_messenger"
  target_type: string;      // 被影响的对象类型：letter/barcode/user/config
  target_id: string;        // 对象唯一标识
  meta: object;             // 补充字段，如IP、前值、后值等
  created_at: datetime;
  ip_address?: string;
  device_info?: string;
}
```

---

## **四、典型日志示例**

  

### **4.1 用户写信成功**

```
{
  "actor_id": "user_83912",
  "action": "generate_letter",
  "target_type": "letter",
  "target_id": "letter_20250817_A12",
  "meta": {
    "length": 478,
    "is_anonymous": true
  }
}
```

### **4.2 管理员关闭某城市漂流信功能**

```
{
  "actor_id": "admin_01",
  "action": "update_config",
  "target_type": "config",
  "target_id": "city.HZ.features.drifting_enabled",
  "meta": {
    "before": true,
    "after": false
  }
}
```

---

## **五、查看与搜索界面建议**

|**功能**|**描述**|
|---|---|
|多条件筛选|按操作人ID、角色、日期、操作类型、IP等|
|快速定位异常|支持关键词全文搜索（如“barcode作废”、“禁用AI”）|
|导出/归档功能|导出7天/30天日志用于审计或存档（CSV/JSON）|
|操作来源分布图|显示用户主要操作路径（PC/移动/信使端）|

---

## **六、安全控制与合规建议**

|**安全项**|**描述**|
|---|---|
|日志访问权限控制|管理员仅能查看自己城市/学校范围的日志；普通用户仅可查看自身日志|
|敏感信息加密/脱敏|如 IP、device_id 等应加密存储，页面显示脱敏|
|系统日志防删除|所有日志禁止删除，仅支持追加归档|
|非法行为检测集成|日志分析结合行为模型识别刷信/伪造/权限越界等异常操作|

---

## **七、可拓展应用（未来）**

|**拓展方向**|**描述**|
|---|---|
|用户个人日志中心|“我的操作记录” → 查看最近写信、扫码、被回信等|
|AI反馈溯源|每一封AI信件生成背后的配置记录与模型版本变更记录|
|风控联动模块|日志中异常频率触发风控模型自动标记/冻结|

---

是否继续输出下一个模块（如：积分与激励系统、API访问控制系统、任务调度与自动化系统）？或需整理一个平台基础模块全景图帮助你统筹查看？✅