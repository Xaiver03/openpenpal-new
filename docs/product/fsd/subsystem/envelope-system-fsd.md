## **一、模块定位**

信封系统是 OpenPenPal 平台连接线下活动与物流体系的核心物理载体。每封合规投递的信件**必须使用平台专属信封**，每个信封内嵌唯一条码，具备防篡改、可追踪、可审美三重属性。信封也是活动的文化表达物，是视觉与身份的象征。

---

## **二、核心功能列表**

|**功能模块**|**描述**|
|---|---|
|城市信封设计与发行|每期活动由四级信使组织城市级主视觉信封|
|学校信封投稿与定制|三级信使组织校内投稿，设有被采用奖励机制|
|信封条码一体化机制|每个信封贴附唯一条码，扫码后进入绑定流程|
|信封商城与分发渠道|平台支持线上商城购买、商店自提、宿舍投放等方式获取|
|信封库存管理|管理信封编号、库存数量、分发记录|
|信封验证与防伪机制|信封 + 条码一一对应，不可分离或伪造|
|信封样式配置系统|不同学校/城市信封可配置字体、图案、主题语等参数|

---

## **三、信封类型与发布机制**

  

### **3.1 城市级统一信封（由四级信使设计）**

- 每次活动必须发布一款城市级标准信封
    
- 所有未设置学校定制信封的用户，默认使用该款信封
    
- 必须包含平台 Logo、城市标识、活动主题元素
    

  

### **3.2 校园定制信封（由三级信使征集）**

- 可由校内同学投稿，社区投票/审核后采用
    
- 被采用者获得现金奖励（建议：200元/次）
    
- 若未发布，自动使用城市信封
    

---

## **四、获取与流通方式**

|**获取方式**|**说明**|
|---|---|
|平台商城|在线购买（每封定价 2–4 元），包含贴好条码的实物信封包邮发出|
|商店自提|用户选择自提点，凭订单编号前往领取|
|信使投放|由一级/二级信使统一派送到宿舍|
|校内活动发放|可线下举办“写信交换节”等活动现场赠送|
|条码下载 → 自助打印|特殊情况下提供条码 PDF + 打印信封模板，自行装订（非官方推荐）|

---

## **五、信封-条码绑定逻辑**

|**阶段**|**操作逻辑**|
|---|---|
|发货前|系统生成条码 → 写入数据库 → 打印贴纸 → 贴在信封上|
|用户扫码后|条码进入绑定界面，用户填写信件信息 & OP Code|
|投递后|条码记录状态变更，信封即视为“封存”|
|防止重复使用|一封信使用一次条码，信封与条码强绑定，不得替换|

---

## **六、接口设计**

  

### **6.1 创建信封设计（POST** 

### **/api/envelopes/design**

### **）**

|**字段**|**类型**|**描述**|
|---|---|---|
|school_code|string|学校编码前2位|
|type|enum|city / school|
|theme|string|本期主题|
|image_url|string|设计图 URL|
|creator_id|string|投稿人 user_id|

---

### **6.2 获取信封样式（GET** 

### **/api/envelopes?school_code=PK**

### **）**

- 返回该学校当前可用的所有信封样式（城市+学校）
    
- 返回字段包括信封图片、设计人、可用渠道、价格等
    

---

### **6.3 信封 + 条码批量生成（admin 端）**

```
POST /api/envelopes/batch-generate

Payload:
{
  school_code: "PK",
  quantity: 500,
  barcode_prefix: "PK2307",
  distributor_id: "user-xxx"
}
```

**返回：信封编号 + 条码编号对照表 + 下载 PDF 贴纸包**

---

## **七、数据结构（简要）**

```
Envelope {
  id: string,
  school_code: string,
  type: "city" | "school",
  theme: string,
  image_url: string,
  price: number,
  barcode_id: string,
  distributor: string,
  status: "unsent" | "used",
  created_at: datetime
}
```

---

## **八、安全与防伪机制**

|**机制**|**描述**|
|---|---|
|条码唯一性校验|所有信封条码系统后台统一管理，不可重复|
|双向绑定验证|条码与信封一旦绑定后不可更换|
|用户扫码绑定限制|未绑定条码扫码后自动跳转绑定页面，绑定后锁定|
|二维码加密机制|可添加签名字段防止生成恶意二维码|
|设计审核机制|所有新信封需三级信使审核发布后方可销售使用|

---

## **九、与其他系统接口**

|**模块**|**描述**|
|---|---|
|条码系统|每个信封需绑定唯一条码编号，防止混用|
|编码系统|用户扫码信封后需填写 OP Code|
|信使系统|投递任务需检查信封是否合规（绑定成功、在有效期内）|
|写信系统|完成写信后可选择“已拥有信封”或“在线购买信封”|
|AI系统|可对信封样式进行推荐/情绪匹配（增强体验）|
