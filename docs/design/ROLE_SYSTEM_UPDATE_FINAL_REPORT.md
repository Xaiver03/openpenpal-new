# OpenPenPal è§’è‰²ç³»ç»Ÿæ›´æ–°æœ€ç»ˆæŠ¥å‘Š

> ç”Ÿæˆæ—¶é—´: 2025-08-09
> æ‰§è¡ŒçŠ¶æ€: åç«¯æ›´æ–°å·²å®Œæˆ

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åç«¯è§’è‰²ç³»ç»Ÿæ›´æ–°
- âœ… **user.go**: è§’è‰²å®šä¹‰å·²ç®€åŒ–ä¸º7ç§è§’è‰²
- âœ… **æƒé™æ˜ å°„**: æ›´æ–°ä¸ºç¬¦åˆPRDçš„æƒé™ä½“ç³»
- âœ… **database.go**: ç§»é™¤å†—ä½™ç”¨æˆ·ç§å­æ•°æ®
- âœ… **courier_service.go**: æ›´æ–°è§’è‰²å¼•ç”¨
- âœ… **websocket/client.go**: æ›´æ–°è§’è‰²æƒé™æ£€æŸ¥
- âœ… **role_mapping.go**: æ›´æ–°è§’è‰²æ˜ å°„å…³ç³»

### 2. æ–‡ä»¶å¤‡ä»½
æ‰€æœ‰ä¿®æ”¹çš„æ–‡ä»¶éƒ½å·²å¤‡ä»½ï¼š
- `user.go.backup`
- `database.go.backup2`
- `*.role_backup` (å„æœåŠ¡æ–‡ä»¶)
- `role_mapping.go.backup3`

### 3. è§’è‰²ç³»ç»Ÿç°çŠ¶

#### ä¿ç•™çš„è§’è‰²ï¼ˆç¬¦åˆPRDï¼‰
| è§’è‰² | è¯´æ˜ | å±‚çº§ |
|------|------|------|
| `user` | æ™®é€šç”¨æˆ· | 1 |
| `courier_level1` | ä¸€çº§ä¿¡ä½¿ï¼ˆåŸºç¡€æŠ•é€’ä¿¡ä½¿ï¼‰ | 2 |
| `courier_level2` | äºŒçº§ä¿¡ä½¿ï¼ˆç‰‡åŒºåè°ƒå‘˜ï¼‰ | 3 |
| `courier_level3` | ä¸‰çº§ä¿¡ä½¿ï¼ˆæ ¡åŒºè´Ÿè´£äººï¼‰ | 4 |
| `courier_level4` | å››çº§ä¿¡ä½¿ï¼ˆåŸå¸‚è´Ÿè´£äººï¼‰ | 5 |
| `platform_admin` | å¹³å°ç®¡ç†å‘˜ | 6 |
| `super_admin` | è¶…çº§ç®¡ç†å‘˜ | 7 |

#### å·²ç§»é™¤çš„è§’è‰²
- âŒ `courier` â†’ æ˜ å°„åˆ° `courier_level1`
- âŒ `senior_courier` â†’ æ˜ å°„åˆ° `courier_level2`
- âŒ `courier_coordinator` â†’ æ˜ å°„åˆ° `courier_level3`
- âŒ `school_admin` â†’ æ˜ å°„åˆ° `courier_level3`

### 4. æƒé™ä½“ç³»æ›´æ–°

å››çº§ä¿¡ä½¿æƒé™é€’å¢ï¼š
- **L1**: åŸºç¡€æŠ•é€’æƒé™
- **L2**: L1 + ä»»åŠ¡åˆ†å‘
- **L3**: L2 + ä¿¡ä½¿ç®¡ç†ã€æŠ¥å‘ŠæŸ¥çœ‹
- **L4**: L3 + å­¦æ ¡å¼€é€šã€åŸå¸‚è°ƒåº¦

## âŒ å¾…å®Œæˆçš„å·¥ä½œ

### 1. å‰ç«¯æ›´æ–°
- [ ] æ›´æ–° `frontend/src/constants/roles.ts`
- [ ] ç§»é™¤å‰ç«¯ç»„ä»¶ä¸­çš„æ—§è§’è‰²å¼•ç”¨
- [ ] æ›´æ–°æƒé™æ£€æŸ¥é€»è¾‘

### 2. æµ‹è¯•éªŒè¯
- [ ] å„è§’è‰²ç™»å½•æµ‹è¯•
- [ ] æƒé™è®¿é—®æµ‹è¯•
- [ ] ä¿¡ä½¿åŠŸèƒ½æµ‹è¯•
- [ ] WebSocketæƒé™æµ‹è¯•

### 3. æ•°æ®åº“æ¸…ç†ï¼ˆå¦‚éœ€è¦ï¼‰
```sql
-- æ£€æŸ¥æ˜¯å¦æœ‰ä½¿ç”¨æ—§è§’è‰²çš„ç”¨æˆ·
SELECT username, role FROM users 
WHERE role IN ('courier', 'senior_courier', 'courier_coordinator', 'school_admin', 'admin');
```

## ğŸ“‹ éªŒè¯æ¸…å•

### åç«¯éªŒè¯ï¼ˆå·²å®Œæˆï¼‰
- [x] è§’è‰²å¸¸é‡å®šä¹‰åªåŒ…å«7ç§è§’è‰²
- [x] æƒé™æ˜ å°„æ­£ç¡®é…ç½®
- [x] ç§å­æ•°æ®ä¸åŒ…å«å†—ä½™ç”¨æˆ·
- [x] æœåŠ¡æ–‡ä»¶ä½¿ç”¨æ­£ç¡®çš„è§’è‰²å¼•ç”¨
- [x] è§’è‰²æ˜ å°„æä¾›å‘åå…¼å®¹æ€§

### å‰ç«¯éªŒè¯ï¼ˆå¾…è¿›è¡Œï¼‰
- [ ] roles.ts åªå®šä¹‰7ç§è§’è‰²
- [ ] ç»„ä»¶ä½¿ç”¨æ­£ç¡®çš„è§’è‰²æ£€æŸ¥
- [ ] å¯¼èˆªèœå•æƒé™æ­£ç¡®
- [ ] APIè°ƒç”¨ä½¿ç”¨æ­£ç¡®çš„è§’è‰²

## ğŸ”§ å›æ»šæ–¹æ¡ˆ

å¦‚éœ€å›æ»šï¼Œä½¿ç”¨ä»¥ä¸‹å¤‡ä»½æ–‡ä»¶ï¼š
```bash
# æ¢å¤user.go
cp backend/internal/models/user.go.backup backend/internal/models/user.go

# æ¢å¤database.go
cp backend/internal/config/database.go.backup2 backend/internal/config/database.go

# æ¢å¤å…¶ä»–æ–‡ä»¶
cp backend/internal/services/courier_service.go.role_backup backend/internal/services/courier_service.go
cp backend/internal/websocket/client.go.role_backup backend/internal/websocket/client.go
cp backend/internal/models/role_mapping.go.backup3 backend/internal/models/role_mapping.go
```

## ğŸ“ æ€»ç»“

åç«¯è§’è‰²ç³»ç»Ÿå·²æˆåŠŸç®€åŒ–ä¸ºç¬¦åˆPRDçš„7ç§è§’è‰²ä½“ç³»ã€‚ä¸»è¦æˆæœï¼š
1. **ä»£ç ç®€åŒ–**: ç§»é™¤äº†4ç§å†—ä½™è§’è‰²å®šä¹‰
2. **æƒé™æ¸…æ™°**: å››çº§ä¿¡ä½¿æƒé™é€’å¢ï¼Œç®¡ç†è§’è‰²æƒé™æ˜ç¡®
3. **å‘åå…¼å®¹**: é€šè¿‡role_mapping.goä¿æŒå…¼å®¹æ€§

ä¸‹ä¸€æ­¥éœ€è¦ï¼š
1. æ›´æ–°å‰ç«¯ä»£ç ä»¥åŒ¹é…åç«¯
2. æ‰§è¡Œå®Œæ•´çš„é›†æˆæµ‹è¯•
3. å‡†å¤‡ç”¨æˆ·è¿ç§»é€šçŸ¥ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰